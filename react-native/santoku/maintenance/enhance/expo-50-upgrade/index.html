<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-react-native/santoku/maintenance/enhance/expo-50-upgrade" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Expo SDK 50アップグレード | Fintan » Mobile App Development</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fintan-contents.github.io/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-50-upgrade"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Expo SDK 50アップグレード | Fintan » Mobile App Development"><meta data-rh="true" name="description" content="以下の記事を参考にして、このアプリのExpo SDKを50にアップグレードしました。"><meta data-rh="true" property="og:description" content="以下の記事を参考にして、このアプリのExpo SDKを50にアップグレードしました。"><link data-rh="true" rel="icon" href="/mobile-app-crib-notes/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fintan-contents.github.io/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-50-upgrade"><link data-rh="true" rel="alternate" href="https://fintan-contents.github.io/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-50-upgrade" hreflang="ja"><link data-rh="true" rel="alternate" href="https://fintan-contents.github.io/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-50-upgrade" hreflang="x-default"><script src="https://plausible.io/js/script.js" defer="defer" data-domain="fintan-contents.github.io,all.fintan"></script><link rel="stylesheet" href="/mobile-app-crib-notes/assets/css/styles.b068789d.css">
<link rel="preload" href="/mobile-app-crib-notes/assets/js/runtime~main.614d1847.js" as="script">
<link rel="preload" href="/mobile-app-crib-notes/assets/js/main.27dbf87e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://fintan.jp" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/mobile-app-crib-notes/img/fintan-logo.jpg" alt="Fintan Mobile App" class="themedImage_ToTc themedImage--light_HNdA"><img src="/mobile-app-crib-notes/img/fintan-logo.jpg" alt="Fintan Mobile App" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/mobile-app-crib-notes/">Home</a><a class="navbar__item navbar__link" href="/mobile-app-crib-notes/reference">Reference</a><a class="navbar__item navbar__link" href="/mobile-app-crib-notes/distribution">Distribution</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">React Native</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/mobile-app-crib-notes/react-native/learn">Learn</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/mobile-app-crib-notes/react-native/santoku">Example App</a></li><li><a class="dropdown__link" href="/mobile-app-crib-notes/react-native/common-pitfalls">Trouble shooting</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/fintan-contents/mobile-app-crib-notes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a href="https://fintan.jp" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_isFc"><img src="/mobile-app-crib-notes/img/fintan-logo.jpg" alt="Fintan Mobile App" class="themedImage_ToTc themedImage--light_HNdA"><img src="/mobile-app-crib-notes/img/fintan-logo.jpg" alt="Fintan Mobile App" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mobile-app-crib-notes/react-native/santoku">はじめに</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mobile-app-crib-notes/react-native/santoku/requirements">Requirements</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mobile-app-crib-notes/react-native/santoku/application-architecture">Application Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mobile-app-crib-notes/react-native/santoku/test-planning">Test Planning</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mobile-app-crib-notes/react-native/santoku/design">Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mobile-app-crib-notes/react-native/santoku/development">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/mobile-app-crib-notes/react-native/santoku/maintenance">Maintenance</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-app-crib-notes/react-native/santoku/maintenance">目次</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance">エンハンス</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance">概要</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-51-upgrade">Expo SDK 51アップグレード</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-50-upgrade">Expo SDK 50アップグレード</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-49-upgrade">Expo SDK 49アップグレード</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-48-upgrade">Expo SDK 48アップグレード</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-47-upgrade">Expo SDK 47アップグレード</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/config-plugins">Config Plugins対応</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-46-upgrade">Expo SDK 46アップグレード</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mobile-app-crib-notes/react-native/santoku/decisions">Decision Records</a></div></li></ul></nav><button type="button" title="サイドバーを隠す" aria-label="サイドバーを隠す" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>Expo SDK 50アップグレード</h1></header><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>参考</div><div class="admonitionContent_S0QG"><p>以下の記事を参考にして、このアプリのExpo SDKを50にアップグレードしました。
主な変更点とこのアプリで実施したアップグレード手順を紹介します。</p><ul><li><a href="https://expo.dev/changelog/2024/01-18-sdk-50" target="_blank" rel="noopener noreferrer">Expo SDK 50 - Expo Changelog</a></li><li><a href="https://reactnative.dev/blog/2023/12/06/0.73-debugging-improvements-stable-symlinks" target="_blank" rel="noopener noreferrer">React Native 0.73 - Debugging Improvements, Stable Symlink Support, and more · React Native</a></li></ul><p>なお、使用される可能性の低いEASとReact Native Webに関する内容は記載しません。</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="expo-sdk-50の主な変更">Expo SDK 50の主な変更<a href="#expo-sdk-50の主な変更" class="hash-link" aria-label="Expo SDK 50の主な変更 への直接リンク" title="Expo SDK 50の主な変更 への直接リンク">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react-native-v0736">React Native <code>v0.73.6</code><a href="#react-native-v0736" class="hash-link" aria-label="react-native-v0736 への直接リンク" title="react-native-v0736 への直接リンク">​</a></h3><p>詳細は、以下のリンク先を参照してください。</p><ul><li><a href="https://reactnative.dev/blog/2023/12/06/0.73-debugging-improvements-stable-symlinks" target="_blank" rel="noopener noreferrer">React Native 0.73 - Debugging Improvements, Stable Symlink Support, and more · React Native</a></li><li><a href="https://github.com/facebook/react-native/blob/main/CHANGELOG.md#v0736" target="_blank" rel="noopener noreferrer">React Native CHANGELOG</a></li></ul><p>Reactのバージョンは変更されておらず、依然として<code>v18.2.0</code>です。</p><p>非推奨となっていた以下のコンポーネントは、React Native <code>v0.73.0</code>で削除されました。以下に挙げるコミュニティライブラリなどへの移行が必要です。</p><ul><li><a href="https://reactnative.dev/docs/progressbarandroid" target="_blank" rel="noopener noreferrer">ProgressBarAndroid</a><ul><li><a href="https://github.com/react-native-progress-view/progress-bar-android" target="_blank" rel="noopener noreferrer">@react-native-community/progress-bar-android</a></li><li><a href="https://reactnative.directory/?search=progressbar" target="_blank" rel="noopener noreferrer">progressbar - React Native Directory</a></li></ul></li><li><a href="https://reactnative.dev/docs/progressviewios" target="_blank" rel="noopener noreferrer">ProgressViewIOS</a><ul><li><a href="https://github.com/react-native-progress-view/progress-view" target="_blank" rel="noopener noreferrer">@react-native-community/progress-view</a></li><li><a href="https://reactnative.directory/?search=progressview" target="_blank" rel="noopener noreferrer">progressview - React Native Directory</a></li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="プラットフォームに関連する破壊的変更">プラットフォームに関連する破壊的変更<a href="#プラットフォームに関連する破壊的変更" class="hash-link" aria-label="プラットフォームに関連する破壊的変更 への直接リンク" title="プラットフォームに関連する破壊的変更 への直接リンク">​</a></h3><p>Android、iOSのプラットフォーム関連で以下のような変更がされています。</p><ul><li>Androidの最低サポートバージョンが、<strong>Android 6 (API 23)</strong>に変更されました</li><li>iOSの最低サポートバージョンが、<strong>13.4</strong>に変更されました</li><li>Android Gradle Pluginのバージョンが8になり、<strong>Java 17</strong>が必須となりました<ul><li>Androidアプリをビルドする場合は、Java 17をインストールする必要があります</li></ul></li><li>Node.jsのバージョンは<strong>18</strong>以上が必須となりました</li><li>React Nativeのテンプレートに含まれるAndroid用の<code>Main*</code>クラスがJavaからKotlinに変更されました<ul><li><code>MainApplication.java</code> → <code>MainApplication.kt</code></li><li><code>MainActivity.java</code> → <code>MainActivity.kt</code></li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dev-toolsの改善">Dev toolsの改善<a href="#dev-toolsの改善" class="hash-link" aria-label="Dev toolsの改善 への直接リンク" title="Dev toolsの改善 への直接リンク">​</a></h3><p>デバッグに利用できる<a href="https://docs.expo.dev/debugging/devtools-plugins/" target="_blank" rel="noopener noreferrer">Dev tools plugin</a>が導入されました。以下のようなライブラリでの開発を効率化するためのプラグインが公開されているようです。</p><ul><li><a href="https://docs.expo.dev/debugging/devtools-plugins/#react-navigation" target="_blank" rel="noopener noreferrer">React Navigation</a></li><li><a href="https://docs.expo.dev/debugging/devtools-plugins/#apollo-client" target="_blank" rel="noopener noreferrer">Apollo Client</a></li><li><a href="https://docs.expo.dev/debugging/devtools-plugins/#react-query" target="_blank" rel="noopener noreferrer">React Query</a></li><li><a href="https://docs.expo.dev/debugging/devtools-plugins/#redux" target="_blank" rel="noopener noreferrer">Redux</a></li><li><a href="https://docs.expo.dev/debugging/devtools-plugins/#tinybase" target="_blank" rel="noopener noreferrer">TinyBase</a></li></ul><p>サンプルアプリではまだ利用していませんが、これらのライブラリを利用している場合はDev toolsの利用を検討してみると良さそうです。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react-native-pickerpickerのiosでの振る舞い変更"><code>@react-native-picker/picker</code>のiOSでの振る舞い変更<a href="#react-native-pickerpickerのiosでの振る舞い変更" class="hash-link" aria-label="react-native-pickerpickerのiosでの振る舞い変更 への直接リンク" title="react-native-pickerpickerのiosでの振る舞い変更 への直接リンク">​</a></h3><p><code>@react-native-picker/picker</code>が、iOSでは<code>value</code>を必ず文字列化するように変更されました。そのため、以下のようなコードでも<strong>iOSでは<code>setCount</code>に文字列が渡されます</strong>。</p><div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">CountPicker</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> setCount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:rgb(130, 170, 255)">useState</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token generic-function generic class-name builtin" style="color:rgb(130, 170, 255)">number</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Picker</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">selectedValue</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">count</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">onValueChange</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">setCount</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Picker.Item</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">label</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">Count 1</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript number" style="color:rgb(247, 140, 108)">1</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Picker.Item</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">label</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">Count 2</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript number" style="color:rgb(247, 140, 108)">2</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Picker</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>この変更の影響に関して、以下のようなIssueが報告されています。<code>value</code>として文字列以外を渡している場合は注意してください。</p><ul><li><a href="https://github.com/react-native-picker/picker/issues/538" target="_blank" rel="noopener noreferrer">Picker 2.6+ transforms numeric values to strings</a></li><li><a href="https://github.com/react-native-picker/picker/issues/540" target="_blank" rel="noopener noreferrer">Selected value jumps back to first value when &quot;Done&quot; is tapped - Picker library v2.6.1, iOS only</a></li></ul><p>例えば、以下のようにPickerを実装している場合、この変更によって項目を選択できなくなってしまうので注意してください。</p><div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports">useCallback</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports">useState</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;react&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports maybe-class-name">Picker</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@react-native-picker/picker&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ItemType</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">value</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">ITEMS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">value</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">value</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">value</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">value</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">DEFAULT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">ITEMS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">CountPicker</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">selected</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> setSelected</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:rgb(130, 170, 255)">useState</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(255, 203, 107)">ItemType</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">DEFAULT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> onValueChange </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// iOSでは、選択された値（sel）として文字列化されたvalueが渡されてしまう。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// そのため、find内での比較で一致するものが見つからず、結果としてselectedが変更されない</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sel</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setSelected</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">ITEMS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">find</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">item </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> item</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> sel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">??</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">DEFAULT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Picker</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">selectedValue</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">selected</span><span class="token tag script language-javascript operator" style="color:rgb(137, 221, 255)">?.</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">value</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">onValueChange</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">onValueChange</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token constant" style="color:rgb(130, 170, 255)">ITEMS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">item </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Picker.Item</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">label</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript known-class-name class-name" style="color:rgb(255, 203, 107)">String</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">item</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token tag script language-javascript property-access" style="color:rgb(255, 85, 114)">value</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">item</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token tag script language-javascript property-access" style="color:rgb(255, 85, 114)">value</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">Picker</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>なお、<code>@react-native-picker/piker</code>をラップしている<code>react-native-picker-select</code>では、数値を<code>value</code>として渡していると項目が選択できなくなります。</p><ul><li><a href="https://github.com/lawnstarter/react-native-picker-select/issues/530" target="_blank" rel="noopener noreferrer">Not able to select Number values since @react-native-picker/picker upgrade to 2.6.1</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ネイティブプロジェクトの更新ヘルパー">ネイティブプロジェクトの更新ヘルパー<a href="#ネイティブプロジェクトの更新ヘルパー" class="hash-link" aria-label="ネイティブプロジェクトの更新ヘルパー への直接リンク" title="ネイティブプロジェクトの更新ヘルパー への直接リンク">​</a></h3><p>ネイティブプロジェクトのアップグレードの参考になるように、<a href="https://docs.expo.dev/bare/upgrade/" target="_blank" rel="noopener noreferrer">Native project upgrade helper</a>がExpoから提供されるようになりました。</p><p>React Nativeコミュニティのプロジェクトテンプレート向けには、以前から<a href="https://react-native-community.github.io/upgrade-helper/" target="_blank" rel="noopener noreferrer">React Native Upgrade Helper</a>が提供されていましたが、そのExpoテンプレート版になります。</p><p>たとえば、SDK 49からSDK 50への修正にあたって更新されたExpoテンプレートのネイティブプロジェクトファイルは、以下のURLで確認できます。</p><p><a href="https://docs.expo.dev/bare/upgrade/?fromSdk=49&amp;toSdk=50" target="_blank" rel="noopener noreferrer">https://docs.expo.dev/bare/upgrade/?fromSdk=49&amp;toSdk=50</a></p><p>自分たちで管理しているネイティブプロジェクトファイルに対してこれらの修正を加えることで、テンプレートの状態をSDK 50のデフォルト状態に合わせることができます。</p><p>このアプリのようにExpo prebuildを利用した<a href="https://docs.expo.dev/workflow/continuous-native-generation/" target="_blank" rel="noopener noreferrer">Continuous Native Generation (CNG)</a>を採用している場合、これらの変更はネイティブプロジェクトの生成時に自動的に反映されます。そういった場合でも、具体的にどのような変更が加わったのかを把握するために活用できます。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="urlおよびurlsearchparamsの組み込み"><code>URL</code>および<code>URLSearchParams</code>の組み込み<a href="#urlおよびurlsearchparamsの組み込み" class="hash-link" aria-label="urlおよびurlsearchparamsの組み込み への直接リンク" title="urlおよびurlsearchparamsの組み込み への直接リンク">​</a></h3><p>React Nativeで<code>URL</code>や<code>URLSearchParam</code>の全機能を利用するためには、<code>react-native-url-polyfill</code>などのポリフィルを利用する必要がありました。</p><p>Expo SDK 50ではこれらの標準APIがExpoのランタイムに組み込まれたので、ポリフィルは不要になりました。</p><p>詳細は<a href="https://docs.expo.dev/versions/v50.0.0/sdk/url/" target="_blank" rel="noopener noreferrer">URL - Expo Documentation</a>を参照してください。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="xcodeからアプリを起動した場合metro-bundlerが起動しないように変更">Xcodeからアプリを起動した場合、Metro Bundlerが起動しないように変更<a href="#xcodeからアプリを起動した場合metro-bundlerが起動しないように変更" class="hash-link" aria-label="Xcodeからアプリを起動した場合、Metro Bundlerが起動しないように変更 への直接リンク" title="Xcodeからアプリを起動した場合、Metro Bundlerが起動しないように変更 への直接リンク">​</a></h3><p>Xcodeからアプリを起動したり、ビルドした場合にMetro Bundlerが自動的には起動しなくなりました。ビルドの際は特に問題ありませんが、アプリを起動する際は別途Metro Bundlerを立ち上げる必要があります。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="expoがサポートするライブラリや機能">Expoがサポートするライブラリや機能<a href="#expoがサポートするライブラリや機能" class="hash-link" aria-label="Expoがサポートするライブラリや機能 への直接リンク" title="Expoがサポートするライブラリや機能 への直接リンク">​</a></h3><p>以下に挙げる変更点の詳細やその他の変更については、<a href="https://github.com/expo/expo/blob/main/CHANGELOG.md#5000--2023-12-12" target="_blank" rel="noopener noreferrer">ExpoのChangelog</a>を参照してください。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ライブラリの更新">ライブラリの更新<a href="#ライブラリの更新" class="hash-link" aria-label="ライブラリの更新 への直接リンク" title="ライブラリの更新 への直接リンク">​</a></h4><ul><li><a href="https://docs.expo.dev/guides/icons/" target="_blank" rel="noopener noreferrer">@expo/vector-icons</a><ul><li><code>react-native-vector-icons@10.0.0</code>を使うように更新されました</li><li><a href="https://ionic.io/ionicons" target="_blank" rel="noopener noreferrer">Ionicons</a>をアイコンとして利用する場合のアイコン名が変更され、<strong><code>md-</code>および<code>ios-</code>というプレフィックスが削除されました</strong></li></ul></li><li><a href="https://docs.expo.dev/router/introduction/" target="_blank" rel="noopener noreferrer">expo-router</a> <code>v3</code><ul><li>参考：<a href="https://expo.dev/changelog/2024/01-23-router-3" target="_blank" rel="noopener noreferrer">Expo Router v3: API Routes, bundle splitting, speed improvements, and more</a></li></ul></li><li><a href="https://docs.expo.dev/versions/v50.0.0/sdk/font/" target="_blank" rel="noopener noreferrer">expo-font</a><ul><li>Config Pluginを利用して、フォントをネイティブリソースとして追加できるようになりました。詳細については、Expoの<a href="https://docs.expo.dev/develop/user-interface/fonts/#use-a-custom-font" target="_blank" rel="noopener noreferrer">Fontについてのガイド</a>も参考にしてください。</li></ul></li><li><a href="https://docs.expo.dev/versions/v50.0.0/sdk/securestore/" target="_blank" rel="noopener noreferrer">expo-secure-store</a><ul><li>同期的に処理する<code>getItem</code>と<code>setItem</code>が追加されました。</li><li>キーが存在しない場合の振る舞いがiOSとAndroidで統一され、<code>null</code>を返すようになりました。修正前はAndroidでは例外が送出されていました。</li><li>iOSで顔認証を利用する場合に必要となる<code>NSFaceIDUsageDescription</code>を、<code>app.config.js</code>で設定できるようになりました。詳細は<a href="https://docs.expo.dev/versions/v50.0.0/sdk/securestore/" target="_blank" rel="noopener noreferrer">Expo SecureStore</a>を参照してください。</li></ul></li><li><a href="https://docs.expo.dev/guides/customizing-metro/" target="_blank" rel="noopener noreferrer">@expo/metro-config</a><ul><li><code>tsconfig.json</code>で設定した<code>paths</code>が自動で読み込まれるようになり、設定なしでもpath aliasが正しく解決されるようになりました。</li><li>ただし、Jestの実行時などには有効にはならないようです。</li></ul></li><li><a href="https://github.com/expo/expo/tree/main/packages/babel-preset-expo#readme" target="_blank" rel="noopener noreferrer">babel-preset-expo</a><ul><li>React Native ReanimatedのBabelプラグインが自動的に有効化されるようになりました。</li><li><a href="https://github.com/oblador/react-native-vector-icons" target="_blank" rel="noopener noreferrer">react-native-vector-icons</a>を<a href="https://docs.expo.dev/guides/icons/" target="_blank" rel="noopener noreferrer">@expo/vector-icons</a>にエイリアスする設定がMetro Resolverに移動されました。
それに伴って、<a href="https://github.com/tleunen/babel-plugin-module-resolver" target="_blank" rel="noopener noreferrer">babel-plugin-module-resolver</a>が依存関係から取り除かれました。<ul><li>このアプリではJestなどでもpath aliasを扱えるようにbabel-preset-module-resolverを利用する必要があります。そのため、<code>devDependencies</code>に明示的に追加して対応しました。</li></ul></li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ライブラリの新機能">ライブラリの新機能<a href="#ライブラリの新機能" class="hash-link" aria-label="ライブラリの新機能 への直接リンク" title="ライブラリの新機能 への直接リンク">​</a></h4><ul><li><a href="https://docs.expo.dev/versions/v50.0.0/sdk/sqlite-next/" target="_blank" rel="noopener noreferrer">expo-sqlite/next</a><ul><li>全面的に書き直され、同期APIやPrepared Statement、Blobデータ型などが利用できるようになりました。</li><li>SDK 50では<code>expo-sqlite/next</code>として公開されていますが、SDK 51では<code>expo-sqlite</code>がこの新SDKに置き換えられています。</li></ul></li><li><a href="https://docs.expo.dev/versions/v50.0.0/sdk/camera-next/" target="_blank" rel="noopener noreferrer">expo-camera/next</a><ul><li>Androidでは、推奨されているCameraXを利用するように変更されています。</li><li>iOS向けには、<a href="https://developer.apple.com/documentation/visionkit/datascannerviewcontroller" target="_blank" rel="noopener noreferrer">DataScannerViewController</a>のサポートが追加されました。</li><li>顔検出機能など利用される頻度が低い機能は削除されました。frame processorを利用するなどの高度な用途向けには<a href="https://github.com/mrousavy/react-native-vision-camera" target="_blank" rel="noopener noreferrer">react-native-vision-camera</a>の利用が推奨されています。</li><li>SDK 50では<code>expo-camera/next</code>として公開されていますが、SDK 51では<code>expo-camera</code>がこの新SDKに置き換えられています。</li><li>詳細は<a href="https://expo.dev/blog/expo-camera-next" target="_blank" rel="noopener noreferrer">expo-camera/next is ready for a close up</a>を参照してください。</li></ul></li><li><a href="https://github.com/expo/expo/tree/main/packages/%40expo/fingerprint" target="_blank" rel="noopener noreferrer">@expo/fingerprint</a><ul><li><code>npx @expo/fingerprint .</code>で、ネイティブモジュールなども含めたアプリのフィンガープリントを取得できるようになりました。</li><li>この機能を利用することで、ビルドされたアプリとJavaScriptバンドルが整合性のあるバージョンとなっているかを検証できるようになります。</li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ライブラリの廃止">ライブラリの廃止<a href="#ライブラリの廃止" class="hash-link" aria-label="ライブラリの廃止 への直接リンク" title="ライブラリの廃止 への直接リンク">​</a></h4><ul><li><a href="https://github.com/expo/sentry-expo" target="_blank" rel="noopener noreferrer">sentry-expo</a><ul><li>Sentryの提供する公式ライブラリ<a href="https://docs.sentry.io/platforms/react-native/" target="_blank" rel="noopener noreferrer">@sentry/react-native</a>がExpoをサポートするようになったため、sentry-expoは廃止予定となりました。</li><li>移行ガイドは<a href="https://github.com/expo/fyi/blob/main/sentry-expo-migration.md" target="_blank" rel="noopener noreferrer">Migrating from sentry-expo to @sentry/react-native</a>を参照してください。</li><li><code>@sentry/react-native</code>の導入方法については<a href="https://docs.expo.dev/guides/using-sentry/" target="_blank" rel="noopener noreferrer">Use Sentry - Expo Documentation</a>を参照してください。</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="このアプリで実施したアップグレードの手順">このアプリで実施したアップグレードの手順<a href="#このアプリで実施したアップグレードの手順" class="hash-link" aria-label="このアプリで実施したアップグレードの手順 への直接リンク" title="このアプリで実施したアップグレードの手順 への直接リンク">​</a></h2><p>このアプリでは、<a href="https://expo.dev/changelog/2024/01-18-sdk-50#%EF%B8%8F-upgrading-your-app" target="_blank" rel="noopener noreferrer">Expo 50へのアップグレード方法</a>を参考に、以下の作業を実施してExpo SDK 50にアップグレードしました。</p><p>アップグレードを実施したプルリクエストは<a href="https://github.com/ws-4020/mobile-app-crib-notes/pull/1321" target="_blank" rel="noopener noreferrer">Pull Request #1321 · ws-4020/mobile-app-crib-notes</a>です。</p><ol><li><a href="#expo%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89">Expoのアップグレード</a></li><li><a href="#expo%E3%81%8C%E7%AE%A1%E7%90%86%E3%81%99%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89">Expoが管理するライブラリのアップグレード</a></li><li><a href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%AE%E6%95%B4%E5%90%88%E6%80%A7%E3%81%8C%E5%8F%96%E3%82%8C%E3%81%AA%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89">バージョンの整合性が取れなくなったライブラリのアップグレード</a></li><li><a href="#%E4%BE%9D%E5%AD%98%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%8B%E3%82%89%E9%99%A4%E5%A4%96%E3%81%95%E3%82%8C%E3%81%9F%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">依存ライブラリから除外されたライブラリのインストール</a></li><li><a href="#%E4%B8%8D%E8%A6%81%E3%81%A8%E3%81%AA%E3%81%A3%E3%81%9F%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%82%A2%E3%83%B3%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">不要となったライブラリのアンインストール</a></li><li><a href="#react-navigation%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E6%9B%B4%E6%96%B0">React Navigationのバージョンを更新</a></li><li><a href="#npx-expo-doctor%E3%81%A7%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E6%95%B4%E5%90%88%E6%80%A7%E3%82%92%E7%A2%BA%E8%AA%8D"><code>npx expo-doctor</code>でバージョン整合性を確認</a></li><li><a href="#%E6%97%A2%E5%AD%98%E3%83%91%E3%83%83%E3%83%81%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E6%9B%B4%E6%96%B0">既存パッチファイルの更新</a></li><li><a href="#%E3%83%93%E3%83%AB%E3%83%89%E3%81%AA%E3%81%A9%E3%81%AB%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E6%9B%B4%E6%96%B0">ビルドなどに利用するツールのバージョンを更新</a></li><li><a href="#config-plugin%E3%81%AE%E4%BF%AE%E6%AD%A3">Config Pluginの修正</a></li><li><a href="#%E9%9D%99%E7%9A%84%E8%A7%A3%E6%9E%90%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E4%BF%AE%E6%AD%A3">静的解析エラーの修正</a></li><li><a href="#%E8%87%AA%E5%8B%95%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E5%A4%B1%E6%95%97%E3%82%92%E4%BF%AE%E6%AD%A3">自動テストの失敗を修正</a></li><li><a href="#react-native-pickerpicker%E3%81%AE%E5%A4%89%E6%9B%B4%E3%81%AB%E4%BC%B4%E3%81%86%E4%BF%AE%E6%AD%A3"><code>@react-native-picker/picker</code>の変更に伴う修正</a></li><li><a href="#expo%E3%81%AE%E6%9B%B4%E6%96%B0%E5%B1%A5%E6%AD%B4%E7%A2%BA%E8%AA%8D%E3%81%A8%E5%AF%BE%E5%BF%9C">Expoの更新履歴確認と対応</a></li><li><a href="#react-native%E3%81%AE%E6%9B%B4%E6%96%B0%E5%B1%A5%E6%AD%B4%E7%A2%BA%E8%AA%8D%E3%81%A8%E5%AF%BE%E5%BF%9C">React Nativeの更新履歴確認と対応</a></li><li><a href="#expo-template-blank-typescript%E3%81%AE%E6%9B%B4%E6%96%B0%E5%B1%A5%E6%AD%B4%E7%A2%BA%E8%AA%8D%E3%81%A8%E5%AF%BE%E5%BF%9C"><code>expo-template-blank-typescript</code>の更新履歴確認と対応</a></li><li><a href="#expo-template-bare-minimum%E3%81%AE%E6%9B%B4%E6%96%B0%E5%B1%A5%E6%AD%B4%E7%A2%BA%E8%AA%8D%E3%81%A8%E5%AF%BE%E5%BF%9C"><code>expo-template-bare-minimum</code>の更新履歴確認と対応</a></li><li><a href="#%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E6%83%85%E5%A0%B1%E3%82%92%E6%9B%B4%E6%96%B0">ライセンス情報を更新</a></li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="expoのアップグレード">Expoのアップグレード<a href="#expoのアップグレード" class="hash-link" aria-label="Expoのアップグレード への直接リンク" title="Expoのアップグレード への直接リンク">​</a></h3><p><code>npm install expo@^50.0.0</code>を実行して、Expo SDK 50の<code>expo</code>パッケージをインストールします。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="expoが管理するライブラリのアップグレード">Expoが管理するライブラリのアップグレード<a href="#expoが管理するライブラリのアップグレード" class="hash-link" aria-label="Expoが管理するライブラリのアップグレード への直接リンク" title="Expoが管理するライブラリのアップグレード への直接リンク">​</a></h3><p><code>npx expo install --fix</code>を実行して、Expoが管理するライブラリをアップグレードします。ただ、今回は一部のパッケージが更新されず、後で実行する<code>npx expo-doctor</code>で検知されました。</p><p>それらのパッケージは手動で後ほどアップグレードします。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="バージョンの整合性が取れなくなったライブラリのアップグレード">バージョンの整合性が取れなくなったライブラリのアップグレード<a href="#バージョンの整合性が取れなくなったライブラリのアップグレード" class="hash-link" aria-label="バージョンの整合性が取れなくなったライブラリのアップグレード への直接リンク" title="バージョンの整合性が取れなくなったライブラリのアップグレード への直接リンク">​</a></h3><p>Expoが管理するライブラリに依存しているライブラリの一部でバージョンの整合性が取れなくなってしまったため、整合性の取れるバージョンに更新しました。</p><ul><li><a href="https://github.com/Expensify/react-native-qrcode-svg" target="_blank" rel="noopener noreferrer">react-native-qrcode-svg</a><ul><li>このライブラリが依存しているreact-native-svgが14系に更新されたため、対応するバージョンに更新しました。</li><li><code>npm i react-native-qrcode-svg@~6.3.0</code></li></ul></li><li><a href="https://docs.expo.dev/config-plugins/introduction/" target="_blank" rel="noopener noreferrer">@expo/config-plugins</a><ul><li><code>npm i -D @expo/config-plugins@~7.9.2</code> </li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="依存ライブラリから除外されたライブラリのインストール">依存ライブラリから除外されたライブラリのインストール<a href="#依存ライブラリから除外されたライブラリのインストール" class="hash-link" aria-label="依存ライブラリから除外されたライブラリのインストール への直接リンク" title="依存ライブラリから除外されたライブラリのインストール への直接リンク">​</a></h3><p>リリースノートには記載がなかったのですが、SDK 49では<code>expo</code>の依存関係に含まれていた<code>expo-application</code>が、SDK 50では含まれなくなっていました。そのため、このアプリの依存関係に含めるように修正しました。</p><ul><li><code>npx expo install expo-application</code></li></ul><p>また<a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E6%9B%B4%E6%96%B0">ライブラリの更新</a>でも触れていますが、<code>babel-preset-expo</code>の更新で<code>babel-plugin-module-resolver</code>が依存関係に含まれなくなりました。このアプリではJest実行時などにもpath aliasを解決する必要があり<code>babel.config.js</code>での設定を削除できなかったため、依存関係に含めるように修正しました。</p><ul><li><code>npm i -D babel-plugin-module-resolver</code></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="不要となったライブラリのアンインストール">不要となったライブラリのアンインストール<a href="#不要となったライブラリのアンインストール" class="hash-link" aria-label="不要となったライブラリのアンインストール への直接リンク" title="不要となったライブラリのアンインストール への直接リンク">​</a></h3><p><code>URL</code>と<code>URLSearchParam</code>がExpoに組み込まれ、<code>react-native-url-polyfill</code>は不要となったためアンインストールしました。</p><ul><li><code>npm uninstall react-native-url-polyfill</code></li><li>SantokuAppルートディレクトリの<code>index.js</code>から<code>import &#x27;react-native-url-polyfill/auto&#x27;;</code>を削除</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react-navigationのバージョンを更新">React Navigationのバージョンを更新<a href="#react-navigationのバージョンを更新" class="hash-link" aria-label="React Navigationのバージョンを更新 への直接リンク" title="React Navigationのバージョンを更新 への直接リンク">​</a></h3><p>今回のExpo SDKバージョンアップに必須ではありませんでしたが、リグレッションテストの効率などを考慮してあわせてアップグレードしました。</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm i @react-navigation/bottom-tabs@~6.6.0 @react-navigation/drawer@~6.7.0 @react-navigation/native-stack@~6.11.0 @react-navigation/stack@~6.4.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="npx-expo-doctorでバージョン整合性を確認"><code>npx expo-doctor</code>でバージョン整合性を確認<a href="#npx-expo-doctorでバージョン整合性を確認" class="hash-link" aria-label="npx-expo-doctorでバージョン整合性を確認 への直接リンク" title="npx-expo-doctorでバージョン整合性を確認 への直接リンク">​</a></h3><p><code>npx expo-doctor</code>で確認したところ、いくつかのライブラリのバージョンについて警告が出力されました。</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ❯❯❯ npx expo-doctor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...略...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The following packages should be updated for best compatibility with the installed expo version:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @types/react@18.2.31 - expected version: ~18.2.45</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  babel-preset-expo@9.5.2 - expected version: ^10.0.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  jest-expo@49.0.0 - expected version: ~50.0.4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  typescript@5.1.6 - expected version: ^5.3.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Your project may not work correctly until you install the correct versions of the packages.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Found outdated dependencies</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Advice: Use &#x27;npx expo install --check&#x27; to review and upgrade your dependencies.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通常は、アドバイス通り<code>npx expo install --check</code>を実行して正しいバージョンに修正するのが望ましいです。しかし、このアプリではTypeScriptが他ライブラリ（<code>msw@1.3.2</code>）と競合してしまったため<code>~5.1.3</code>のままとする必要がありました。
そのため、以下のコマンドでバージョンを更新しました。</p><ul><li><code>npm i -D @types/react@~18.2.45 babel-preset-expo@^10.0.0 jest-expo@^50.0.4</code></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="既存パッチファイルの更新">既存パッチファイルの更新<a href="#既存パッチファイルの更新" class="hash-link" aria-label="既存パッチファイルの更新 への直接リンク" title="既存パッチファイルの更新 への直接リンク">​</a></h3><p>このアプリでは、<a href="https://github.com/ds300/patch-package" target="_blank" rel="noopener noreferrer">patch-package</a>を使用して、以下のライブラリにパッチファイルを適用していました。
パッチ内容の詳細は、<a href="https://github.com/fintan-contents/mobile-app-crib-notes/blob/v2024.10/example-app/SantokuApp/patches/README.md" target="_blank" rel="noopener noreferrer">こちら</a>を参照してください。</p><ul><li><code>@expo/config-plugins</code></li><li><code>expo-splash-screen</code></li><li><code>react-native-elements</code></li></ul><p><code>expo-splash-screen</code>は、Expo SDKのアップグレードに伴いバージョンが上がりました。しかし、適用していたパッチファイルはまだ必要な対応だったため、パッチファイルは削除せずに各ライブラリのバージョンに合わせてファイル名をリネームしました。</p><p><code>@expo/config-plugins</code>はまだ必要な対応だったのですが、バージョンの更新に起因してパッチが失敗するようになりました。修正内容には変更はなかったため、利用しているバージョンでのパッチが成功するようにパッチファイルを作成し直して対応しました。</p><p><code>react-native-elements</code>に関しては、バージョンが変わらなかったため変更はありません。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ビルドなどに利用するツールのバージョンを更新">ビルドなどに利用するツールのバージョンを更新<a href="#ビルドなどに利用するツールのバージョンを更新" class="hash-link" aria-label="ビルドなどに利用するツールのバージョンを更新 への直接リンク" title="ビルドなどに利用するツールのバージョンを更新 への直接リンク">​</a></h3><p>Expo SDK 50から、Javaなどの必要バージョンが変更されています。このアプリの使っているビルド環境にインストールされているRubyのバージョンも変更されていたため、Rubyについてもバージョンを変更しました。
また、<code>npm run pod-install</code>を実行したところFirebase SDKのインストールにCocoaPods 1.12以上が必要というエラーが表示されました。この対応として、CocoaPodsのバージョンも更新しました。</p><ul><li>Java: JDK 17</li><li>Ruby: 3.1.6</li><li>CocoaPods: 1.15.2</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="config-pluginの修正">Config Pluginの修正<a href="#config-pluginの修正" class="hash-link" aria-label="Config Pluginの修正 への直接リンク" title="Config Pluginの修正 への直接リンク">​</a></h3><p>このアプリでは、以下の変更のためにExpo config pluginでAndroidの<code>MainApplication.java</code>と<code>MainActivity.java</code>に修正を加えていました。</p><ul><li>スプラッシュスクリーン表示用のアクティビティ追加</li><li>テスト用のネイティブモジュール追加</li></ul><p>今回のアップグレードでJavaファイルではなくKotlinファイルが利用されるようになったため、Config Pluginに修正を加えて対応しました。</p><ul><li>テンプレートファイルの修正<ul><li>スプラッシュスクリーン表示用のアクティビティとして用意していたテンプレートファイル（<code>MainActivity.java</code>）をKotlin（<code>MainActivity.kt</code>）に変更</li><li>テンプレートファイルのコピー処理の対象拡張子を<code>java</code>から<code>kt</code>に変更</li><li>関連ファイル<ul><li><code>config/plugin/src/android/withAndroidAppActivity.ts</code></li><li><code>config/plugin/src/android/withAndroidCopyMainActivity.ts</code></li></ul></li></ul></li><li>ネイティブモジュール追加のコード片を修正<ul><li><code>MainApplication.java</code>ではなく<code>MainApplication.kt</code>を対象に処理を実施するように修正</li><li>置換用のコード片がJava用になっていたので、Kotlin用のものを追加<ul><li>関連ファイル<ul><li><code>config/plugin/src/android/withAndroidAddNativeModulePakcages.ts</code></li></ul></li></ul></li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="静的解析エラーの修正">静的解析エラーの修正<a href="#静的解析エラーの修正" class="hash-link" aria-label="静的解析エラーの修正 への直接リンク" title="静的解析エラーの修正 への直接リンク">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="削除されたapiをモックから削除">削除されたAPIをモックから削除<a href="#削除されたapiをモックから削除" class="hash-link" aria-label="削除されたAPIをモックから削除 への直接リンク" title="削除されたAPIをモックから削除 への直接リンク">​</a></h4><p>今回のアップグレードで、<code>expo-splash-screen</code>から<code>hide</code>と<code>preventAutoHide</code>というAPIが廃止されていました。</p><p>Jestでのテスト用に<code>expo-splash-screen</code>のモックを用意しているのですが、そこで型エラーとなっていたのでモックしていた部分を削除して対応しました。</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">import SplashScreen from &#x27;expo-splash-screen&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">export const preventAutoHideAsync = jest.fn(() =&gt; Promise.resolve(true));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">export const hideAsync = jest.fn(() =&gt; Promise.resolve(true));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">export const hide = jest.fn();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">export const preventAutoHide = jest.fn();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">const mock: jest.Mocked&lt;typeof SplashScreen&gt; = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  preventAutoHideAsync,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  hideAsync,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  hide,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  preventAutoHide,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">Object.defineProperty(__mocks, &#x27;expoSplashScreen&#x27;, {value: mock});</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">export default mock;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react-native-reanimatedで廃止予定となった型の修正">React Native Reanimatedで廃止予定となった型の修正<a href="#react-native-reanimatedで廃止予定となった型の修正" class="hash-link" aria-label="React Native Reanimatedで廃止予定となった型の修正 への直接リンク" title="React Native Reanimatedで廃止予定となった型の修正 への直接リンク">​</a></h4><p>React Native Reanimatedのv3.5.0で、<code>Reanimated.AnimateProps</code>が廃止予定とされました。</p><p>デフォルトエクスポートから<code>AnimateProps</code>を利用するのではなく、名前付きエクスポートされた<code>AnimatedProps</code>（微妙に型名が変わっていることに注意）を利用するように修正しました。</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">AnimatedPropsを利用するように修正</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">import {composePressableStyles} from &#x27;bases/core/utils/composePressableStyles&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">import React, {useMemo} from &#x27;react&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">import {Modal as RNModal, ModalProps, Pressable, PressableProps, StyleSheet, ViewProps} from &#x27;react-native&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">import Reanimated, {WithTimingConfig} from &#x27;react-native-reanimated&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">import {AnimatedProps, WithTimingConfig} from &#x27;react-native-reanimated&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">import {useModalBackdrop} from &#x27;./useModalBackdrop&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">// 〜〜中略〜〜</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">// React Native ReanimatedのLayout Animationsを使用すると↓の不具合が発生するため、&#x27;exiting&#x27;・&#x27;entering&#x27;の指定ができないようにしています。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">// https://github.com/software-mansion/react-native-reanimated/issues/2906</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">export type ModalBackdropProps = Omit&lt;Reanimated.AnimateProps&lt;ViewProps&gt;, &#x27;exiting&#x27; | &#x27;entering&#x27;&gt; &amp; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">export type ModalBackdropProps = Omit&lt;AnimatedProps&lt;ViewProps&gt;, &#x27;exiting&#x27; | &#x27;entering&#x27;&gt; &amp; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  isVisible: boolean;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  onPress?: () =&gt; unknown;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  afterFadeIn?: (finished?: boolean) =&gt; unknown;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react-native-reanimatedで公開されている型の変更に対応">React Native Reanimatedで公開されている型の変更に対応<a href="#react-native-reanimatedで公開されている型の変更に対応" class="hash-link" aria-label="React Native Reanimatedで公開されている型の変更に対応 への直接リンク" title="React Native Reanimatedで公開されている型の変更に対応 への直接リンク">​</a></h4><p>React Native Reanimatedからはもともと<code>Keyframe</code>という型が公開されていたのですが、クラスが公開されるように変更されました。</p><p>ただ、単純に<code>typeof Keyframe</code>と変更してもエラーが解消せず、公開されていない<code>ReanimatedKeyframe</code>を利用する必要がありました。</p><p>公開されていない型の利用は避けておきたかったので、以下のような型を独自に定義して利用するように修正しました。</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">ReanimatedKeyframe.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">ReduceMotion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;react-native-reanimated&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// WORKAROUND: React Native ReanimatedのKeyframeを引数として受ける際に利用できる適切な型がなかったので、独自に定義して利用しています。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ReanimatedKeyframe</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">duration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">durationMs</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">delay</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">delayMs</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">reduceMotion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">reduceMotionV</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> ReduceMotion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">withCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function-variable function" style="color:rgb(130, 170, 255)">callback</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">finished</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">boolean</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Keyframe</code>の利用箇所は、以下のように修正しています。</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">OverlayContainer.tsx</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">import {useSafeAreaInsets} from &#x27;react-native-safe-area-context&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">import {ReanimatedKeyframe} from &#x27;./ReanimatedKeyframe&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">// 〜〜〜中略〜〜〜</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  /**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   * enteringに指定したAnimationBuilderなどでwithCallbackを指定しても、本コンポーネント内で上書きしているため実行できません。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   * withCallbackで実行する関数は、enteringCallbackで指定してください。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  entering?: BaseAnimationBuilder | Keyframe;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  entering?: BaseAnimationBuilder | ReanimatedKeyframe;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  /**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   * exitingに指定したAnimationBuilderなどでwithCallbackを指定しても、本コンポーネント内で上書きしているため実行できません。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   * withCallbackで実行する関数は、exitingCallbackで指定してください。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  exiting?: BaseAnimationBuilder | Keyframe;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  exiting?: BaseAnimationBuilder | ReanimatedKeyframe;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="不要になった型定義ファイルを削除">不要になった型定義ファイルを削除<a href="#不要になった型定義ファイルを削除" class="hash-link" aria-label="不要になった型定義ファイルを削除 への直接リンク" title="不要になった型定義ファイルを削除 への直接リンク">​</a></h4><p>React Native Reanimatedの以前のバージョンではJest拡張などの型定義が提供されていなかったのですが、現在は提供されるようになっていたため、該当するファイルを削除しました。</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">削除したファイル（src/@types/react-native-reanimated-jest-util.d.ts）</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">declare namespace jest {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  import Reanimated from &#x27;react-native-reanimated&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  import {ImageStyle, TextStyle, ViewStyle} from &#x27;react-native&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  interface Matchers&lt;R&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    toHaveAnimatedStyle(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">      style:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">        | Reanimated.AnimateStyle&lt;ViewStyle | ImageStyle | TextStyle&gt;[]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">        | Reanimated.AnimateStyle&lt;ViewStyle | ImageStyle | TextStyle&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    ): R;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">declare module &#x27;react-native-reanimated/lib/module/reanimated2/jestUtils&#x27; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  import {ReactTestInstance} from &#x27;react-test-renderer&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  import {ImageStyle, TextStyle, ViewStyle} from &#x27;react-native&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  export const withReanimatedTimer: (test: () =&gt; unknown) =&gt; void;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  export const advanceAnimationByTime: (time: number) =&gt; void;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  export const advanceAnimationByFrame: (count: number) =&gt; void;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  export const getAnimatedStyle: &lt;T = ViewStyle | ImageStyle | TextStyle&gt;(instance: ReactTestInstance) =&gt; T;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="自動テストの失敗を修正">自動テストの失敗を修正<a href="#自動テストの失敗を修正" class="hash-link" aria-label="自動テストの失敗を修正 への直接リンク" title="自動テストの失敗を修正 への直接リンク">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react-native-webviewのモックを追加">React Native WebViewのモックを追加<a href="#react-native-webviewのモックを追加" class="hash-link" aria-label="React Native WebViewのモックを追加 への直接リンク" title="React Native WebViewのモックを追加 への直接リンク">​</a></h4><p>テストを実行したところ、<code>WebView</code>利用箇所で以下のようなエラーが発生してしまいテストが失敗するようになっていました。</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mobile-app-crib-notes/example-app/SantokuApp/node_modules/react-native-webview/lib/RNCWebViewNativeComponent.js: Could not find component config for native component</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      18 | import React, {useCallback, useEffect, useState} from &#x27;react&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      19 | import {ActivityIndicator, StyleSheet} from &#x27;react-native&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &gt; 20 | import {WebView as RNWebView, WebViewProps} from &#x27;react-native-webview&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         | ^</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      21 | import {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      22 |   WebViewErrorEvent,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      23 |   WebViewNavigationEvent,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      at throwIfConfigNotfound (node_modules/@react-native/codegen/lib/parsers/error-utils.js:285:11)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      at findComponentConfig (node_modules/@react-native/codegen/lib/parsers/parsers-commons.js:896:3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      at buildComponentSchema (node_modules/@react-native/codegen/lib/parsers/flow/components/index.js:24:32)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      at buildSchemaFromConfigType (node_modules/@react-native/codegen/lib/parsers/parsers-commons.js:462:34)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      at buildSchema (node_modules/@react-native/codegen/lib/parsers/parsers-commons.js:526:10)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      at FlowParser.parseString (node_modules/@react-native/codegen/lib/parsers/flow/parser.js:134:12)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      at parseFile (node_modules/babel-preset-expo/node_modules/@react-native/babel-plugin-codegen/index.js:36:23)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      at generateViewConfig (node_modules/babel-preset-expo/node_modules/@react-native/babel-plugin-codegen/index.js:49:18)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以下のIssueなどを参考に、<code>WebView</code>のモックを追加して対応しました。</p><ul><li><a href="https://github.com/react-native-webview/react-native-webview/issues/2934" target="_blank" rel="noopener noreferrer">Jest fails on v12.0.2</a></li><li><a href="https://github.com/react-native-webview/react-native-webview/issues/3233" target="_blank" rel="noopener noreferrer">Could not find component config for native component</a></li></ul><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">jest/__mocks__/react-native-webview.tsx</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">forwardRef</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> useImperativeHandle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;react&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">View</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;react-native&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">WebView</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> RNWebView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> WebViewProps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;react-native-webview&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> refOverride </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  goBack</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  goForward</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  reload</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  stopLoading</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  injectJavaScript</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  requestFocus</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  postMessage</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  context</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  setState</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  forceUpdate</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  render</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  state</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> jest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> MockWebView </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:rgb(130, 170, 255)">forwardRef</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(255, 203, 107)">RNWebView</span><span class="token generic-function generic class-name punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generic-function generic class-name" style="color:rgb(255, 203, 107)"> WebViewProps</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ref</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">useImperativeHandle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ref</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain">refOverride</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> refs</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">View </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> WebView </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> MockWebView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> MockWebView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react-native-reanimatedのrunonjs実行タイミングの変更">React Native Reanimatedの<code>runOnJS</code>実行タイミングの変更<a href="#react-native-reanimatedのrunonjs実行タイミングの変更" class="hash-link" aria-label="react-native-reanimatedのrunonjs実行タイミングの変更 への直接リンク" title="react-native-reanimatedのrunonjs実行タイミングの変更 への直接リンク">​</a></h4><p>React Native Reanimatedの<code>runOnJS</code>を使っているコールバック関数が、正しく呼び出されることのテストが失敗するようになっていました。</p><p>コールバック関数をマイクロタスクキューに追加するよう変更されていたので、以下のように修正してコールバック関数が実行されるのを待つように修正しました。</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">import {useWorkletCallback} from &#x27;./useWorkletCallback&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">describe(&#x27;useWorkletCallback&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  it(&#x27;should be called callback if callback exits&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  it(&#x27;should be called callback if callback exits&#x27;, async () =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    const callback = jest.fn();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    const {result} = renderHook(props =&gt; useWorkletCallback(props), {initialProps: callback});</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    const hook = result.current;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    hook(true);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    // runOnJSで追加されたコールバックはマイクロタスクとして追加されるので、キューが消化されるのを待たないといけない。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    await Promise.resolve();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    expect(callback).toHaveBeenCalledWith(true);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="act外での状態更新という警告の修正"><code>act</code>外での状態更新という警告の修正<a href="#act外での状態更新という警告の修正" class="hash-link" aria-label="act外での状態更新という警告の修正 への直接リンク" title="act外での状態更新という警告の修正 への直接リンク">​</a></h4><p>React Native Reanimatedのアニメーションを伴う操作をテストしている箇所で、以下のような警告が出力されるようになっていました。</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Warning: An update to PickerBackdrop inside a test was not wrapped in act(...).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">When testing, code that causes React state updates should be wrapped into act(...):</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>React Native Testing Libraryの<code>fireEvent</code>を利用している箇所だったので、同じくライブラリから提供されている<code>waitFor</code>を利用するように変更しました。（テスト関数自体を<code>async</code>に変更する必要があります）</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    fireEvent.press(deleteLink);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    await waitFor(() =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      fireEvent.press(deleteLink);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react-native-pickerpickerの変更に伴う修正"><code>@react-native-picker/picker</code>の変更に伴う修正<a href="#react-native-pickerpickerの変更に伴う修正" class="hash-link" aria-label="react-native-pickerpickerの変更に伴う修正 への直接リンク" title="react-native-pickerpickerの変更に伴う修正 への直接リンク">​</a></h3><p><a href="#react-native-pickerpicker%E3%81%AEios%E3%81%A7%E3%81%AE%E6%8C%AF%E3%82%8B%E8%88%9E%E3%81%84%E5%A4%89%E6%9B%B4"><code>@react-native-picker/picker</code>のiOSでの振る舞い変更</a>に記載した通り、iOSでは<code>Picker.Item</code>に渡した<code>value</code>が強制的に文字列化されてしまいます。また、<code>Picker</code>の<code>onValueChange</code>にも文字列化された値が渡されるようになっています。</p><p>このアプリで独自に実装しているPicker部品にも影響があったため、<code>SelectPicker</code>と<code>YearMonthPicker</code>に以下のような修正を加えました。（修正内容が大きくなってしまうので、主要部分のみ抜き出しています）</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="値にstringもしくはnumber以外を持つ場合は要素を特定するためのkeyを必須とするように変更">値に<code>string</code>もしくは<code>number</code>以外を持つ場合は、要素を特定するための<code>key</code>を必須とするように変更<a href="#値にstringもしくはnumber以外を持つ場合は要素を特定するためのkeyを必須とするように変更" class="hash-link" aria-label="値にstringもしくはnumber以外を持つ場合は要素を特定するためのkeyを必須とするように変更 への直接リンク" title="値にstringもしくはnumber以外を持つ場合は要素を特定するためのkeyを必須とするように変更 への直接リンク">​</a></h4><p><code>@react-native-picker/picker</code>は<code>Picker</code>の<code>selectedValue</code>として、<code>string</code>もしくは<code>nubmer</code>が渡されることを期待しています。これは、<code>Picker</code>内の<code>Picker.Item#value</code>と一致する必要があります。</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">node_modules/@react-native-picker/picker/typings/Picker.d.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">   * Value matching value of one of the items. Can be a string or an integer.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  selectedValue</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>そこで、<code>SelectPicker</code>から<code>Picker</code>と<code>Picker.Item</code>に渡す値が<code>string</code>もしくは<code>number</code>となるように、<code>SelectPicker</code>に渡す要素の型を変更しました。</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">SelectPicker.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">export type ItemSelectionKey = string | number;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">export type Item&lt;T&gt; = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  label: string;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  value: T;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  inputLabel?: string;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  key?: React.Key;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  color?: string;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  fontFamily?: string;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">} &amp; (T extends ItemSelectionKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  ? {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      // valueがstringもしくはnumberの場合は、value自体をkeyの代わりに利用できるので任意としています。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      key?: ItemSelectionKey;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">  : {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      // valueがstringでもnumberでもない場合は、valueをkeyとしては利用できないので、必須としています。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      key: ItemSelectionKey;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上記の差分に含まれてしまっていますが、もともと<code>key</code>は<code>React.Key</code>としていましたが<code>string</code>か<code>number</code>のみ設定できるように変更しています。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="iosの場合のみ選択中要素を取得する際に文字列化した値が一致することを条件とするように変更">iOSの場合のみ、選択中要素を取得する際に文字列化した値が一致することを条件とするように変更<a href="#iosの場合のみ選択中要素を取得する際に文字列化した値が一致することを条件とするように変更" class="hash-link" aria-label="iOSの場合のみ、選択中要素を取得する際に文字列化した値が一致することを条件とするように変更 への直接リンク" title="iOSの場合のみ、選択中要素を取得する際に文字列化した値が一致することを条件とするように変更 への直接リンク">​</a></h4><p><code>SelectPicker</code>に渡された<code>items</code>から選択中の要素を抽出する処理において、iOSでのみ抽出に利用する値を文字列化して比較した値が一致することを条件とするよう修正しました。</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">useSelectPicker.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  const getSelectedItem = useCallback(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    (key?: React.Key | ItemT) =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">      return items.find(item =&gt; item.key === key || item.value === key);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    (key?: ItemSelectionKey | ItemT) =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      return items.find(item =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">        if (Platform.OS === &#x27;ios&#x27;) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">          // @react-native-picker/pickerは、iOSではpickerに渡されたvalueを強制的に文字列化してしまいます。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">          // そのため、onValueChangeに渡されてくる値は文字列となり、valueが文字列でなかった場合は直接比較しても一致しません。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">          // ここでは、@react-native-picker/pickerの内部処理と同様に、双方を文字列化して比較することで、選択中の要素を取得します。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">          return String(item.key) === String(key) || String(item.value) === String(key);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">        return item.key === key || item.value === key;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    [items],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="yearmonthpickerでonselecteditemchangeを呼びだす際に強制的に数値型に変換するように修正"><code>YearMonthPicker</code>で<code>onSelectedItemChange</code>を呼びだす際に強制的に数値型に変換するように修正<a href="#yearmonthpickerでonselecteditemchangeを呼びだす際に強制的に数値型に変換するように修正" class="hash-link" aria-label="yearmonthpickerでonselecteditemchangeを呼びだす際に強制的に数値型に変換するように修正 への直接リンク" title="yearmonthpickerでonselecteditemchangeを呼びだす際に強制的に数値型に変換するように修正 への直接リンク">​</a></h4><p><code>YearMonthPicker</code>では選択中の年月をコールバック関数に渡す処理があるのですが、iOSではこのとき渡される値が文字列化されてしまっていました。</p><p>もともとのコードでは<code>number</code>に型アサーションしていたのですが、強制的に数値に戻すように修正しました。</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">useYearMonthPicker</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  const onValueChangeYear = useCallback(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    (value: React.Key) =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">      const year = value as number;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">      onSelectedItemChange?.(getSelectedYearMonth({year, month: selectedMonth}));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      // iOSではvalueが強制的にstringに変換されてしまうので、number型に変換する。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      onSelectedItemChange?.(getSelectedYearMonth({year: Number(value), month: selectedMonth}));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    [getSelectedYearMonth, onSelectedItemChange, selectedMonth],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  );</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  const onValueChangeMonth = useCallback(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    (value: React.Key) =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">      const month = value as number;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">      onSelectedItemChange?.(getSelectedYearMonth({year: selectedYear, month}));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      // iOSではvalueが強制的にstringに変換されてしまうので、number型に変換する。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      onSelectedItemChange?.(getSelectedYearMonth({year: selectedYear, month: Number(value)}));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    [getSelectedYearMonth, onSelectedItemChange, selectedYear],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="テストの期待値を修正">テストの期待値を修正<a href="#テストの期待値を修正" class="hash-link" aria-label="テストの期待値を修正 への直接リンク" title="テストの期待値を修正 への直接リンク">​</a></h4><p>iOS環境として実行された場合には文字列化されてしまうことの影響で、<code>@react-native-picker/picker</code>に渡されている値のテストが失敗するようになっていました。</p><p>以下のように期待値を修正して対応しました。</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    const yearPicker = screen.getByTestId(&#x27;yearPicker&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    const yearPickerProps = yearPicker.props as SelectPickerItemsProps&lt;string&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    expect(yearPickerProps.items).toEqual([{value: 2022, label: &#x27;2022&#x27;}]);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    const yearPickerProps = yearPicker.props as SelectPickerItemsProps&lt;number&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    // iOS版のPicker（PickerIOS.ios.js）では、PickerItemのvalueをString関数で文字列に変換してネイティブコンポーネントに渡している。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    // そのため、期待値を文字列とする必要がある。</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    expect(yearPickerProps.items).toEqual([{value: &#x27;2022&#x27;, label: &#x27;2022&#x27;}]);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    const monthPicker = screen.getByTestId(&#x27;monthPicker&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    const monthPickerProps = monthPicker.props as SelectPickerItemsProps&lt;string&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    expect(monthPickerProps.items).toEqual([{value: 4, label: &#x27;4&#x27;}]);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    const monthPickerProps = monthPicker.props as SelectPickerItemsProps&lt;number&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    expect(monthPickerProps.items).toEqual([{value: &#x27;4&#x27;, label: &#x27;4&#x27;}]);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="expoの更新履歴確認と対応">Expoの更新履歴確認と対応<a href="#expoの更新履歴確認と対応" class="hash-link" aria-label="Expoの更新履歴確認と対応 への直接リンク" title="Expoの更新履歴確認と対応 への直接リンク">​</a></h3><p>Expoの<a href="https://github.com/expo/expo/blob/sdk-50/CHANGELOG.md#5000--2023-12-12" target="_blank" rel="noopener noreferrer">CHANGELOG</a>を参照して、Expo SDKとExpoが管理するライブラリの更新内容を確認しました。</p><p>ここまでの対応以外に追加で必要なものはありませんでした。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="react-nativeの更新履歴確認と対応">React Nativeの更新履歴確認と対応<a href="#react-nativeの更新履歴確認と対応" class="hash-link" aria-label="React Nativeの更新履歴確認と対応 への直接リンク" title="React Nativeの更新履歴確認と対応 への直接リンク">​</a></h3><p>React Nativeの<a href="https://github.com/facebook/react-native/blob/main/CHANGELOG.md#v0736" target="_blank" rel="noopener noreferrer">CHANGELOG</a>を参照して、React Nativeの更新内容を確認しました。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="androidでのscrollviewonmomentumendの不具合修正">Androidでの<code>ScrollView#onMomentumEnd</code>の不具合修正<a href="#androidでのscrollviewonmomentumendの不具合修正" class="hash-link" aria-label="androidでのscrollviewonmomentumendの不具合修正 への直接リンク" title="androidでのscrollviewonmomentumendの不具合修正 への直接リンク">​</a></h4><p>今回のアップグレード前は、AndroidでScrollViewのスクロール終了時処理（<a href="https://reactnative.dev/docs/scrollview#onmomentumscrollend" target="_blank" rel="noopener noreferrer">onMomentumEnd</a>）が複数回呼び出されてしまうという不具合がありました。</p><p>React Native 0.73.0でこの不具合が修正されました。</p><ul><li><a href="https://github.com/facebook/react-native/pull/32433" target="_blank" rel="noopener noreferrer">(Android/ScrollView) Fix onMomentumScrollEnd being called multiple times</a></li></ul><p>このアプリで実装しているPickerでは、Android向け部品の中でこの問題を回避するための処理を追加していました。今回のアップグレードで不要になっていることが確認できたので、対策していた部分を削除しました。</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">useSelectPickerItems.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  const scrollHandler = useAnimatedScrollHandler(e =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    offset.value = e.contentOffset.y;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  // // 1回のスクロールで、onMomentumScrollEndが複数回実行されてしまう事象に対応</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  // https://github.com/facebook/react-native/issues/32696</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  const canMomentum = useRef(false);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">  const onMomentumScrollBegin = useCallback(() =&gt; (canMomentum.current = true), []);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  const middleIndex = useListMiddleIndex({itemHeight, listSize: items.length});</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  const selectedIndex = useMemo(() =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  // 〜〜〜中略〜〜〜</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  const handleValueChange = useCallback(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    (event: NativeSyntheticEvent&lt;NativeScrollEvent&gt;) =&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">      if (canMomentum.current) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">        canMomentum.current = false;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">        const {index, value} = getRowItemAtOffset(event.nativeEvent.contentOffset.y);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">        _onChange(value, index);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">      }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      const {index, value} = getRowItemAtOffset(event.nativeEvent.contentOffset.y);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      _onChange(value, index);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    [_onChange, getRowItemAtOffset],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  );</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  // 〜〜〜中略〜〜〜</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  return {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    offset,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    flatListRef,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    handleValueChange,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    scrollToPassedIndex,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    scrollHandler,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    selectedIndex,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    height,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    selectItem,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    getItemLayout,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    onMomentumScrollBegin,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">SelectPickerItems.android.tsx</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  const {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    offset,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    height,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    handleValueChange,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    scrollToPassedIndex,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    selectedIndex,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    selectItem,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    getItemLayout,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    flatListRef,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    scrollHandler,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">    onMomentumScrollBegin,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  } = useSelectPickerItems&lt;ItemT&gt;({</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    selectedValue,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    items,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">  // 〜〜〜中略〜〜〜</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">      &lt;Reanimated.FlatList</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        data={items}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        keyExtractor={keyExtractor ?? defaultKeyExtractor}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        style={StyleSheet.flatten([itemsHeightStyle, styles.items])}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        onScroll={scrollHandler}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        onMomentumScrollEnd={handleValueChange}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">        onMomentumScrollBegin={onMomentumScrollBegin}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        showsVerticalScrollIndicator={false}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        onLayout={scrollToPassedIndex}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token unchanged line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">        ref={flatListRef}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cocoapodsのバージョン">CocoaPodsのバージョン<a href="#cocoapodsのバージョン" class="hash-link" aria-label="CocoaPodsのバージョン への直接リンク" title="CocoaPodsのバージョン への直接リンク">​</a></h4><p>React Native v0.73.3時点ではCocoaPodsの最新版が<code>1.15.0</code>だったようなのですが、このバージョンに不具合があったようでv1.15系は利用しないように制限されていました。</p><ul><li><a href="https://github.com/facebook/react-native/pull/42702" target="_blank" rel="noopener noreferrer">Avoid using Cocoapods 1.15 until it fixes an issue affection RN.</a></li><li><a href="https://github.com/facebook/react-native/issues/42698" target="_blank" rel="noopener noreferrer">CocoaPods 1.15.0 : File exists @ syserr_fail2_in Error - Workaround available</a></li></ul><p>しかし、このアプリでのアップデート時点ではこの不具合を修正した<code>1.15.2</code>が公開されており、React Nativeで利用するバージョンも修正されています。</p><ul><li><a href="https://github.com/facebook/react-native/pull/45099" target="_blank" rel="noopener noreferrer">feat: remove upper limit for Cocoapods version (allow for 1.15.2)</a></li></ul><p>ビルドエラーも発生していないことから、今回のアップグレードではCocoaPods <code>1.15.2</code>を利用するよう修正しました。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="expo-template-blank-typescriptの更新履歴確認と対応"><code>expo-template-blank-typescript</code>の更新履歴確認と対応<a href="#expo-template-blank-typescriptの更新履歴確認と対応" class="hash-link" aria-label="expo-template-blank-typescriptの更新履歴確認と対応 への直接リンク" title="expo-template-blank-typescriptの更新履歴確認と対応 への直接リンク">​</a></h3><p><a href="https://github.com/expo/expo/commits/sdk-50/templates/expo-template-blank-typescript" target="_blank" rel="noopener noreferrer"><code>expo-template-blank-typescript</code>の更新履歴</a>を確認しました。</p><p><code>npm install expo@^50.0.0</code>、<code>npx expo install --fix</code>で更新される依存ライブラリのアップグレードが主な変更でした。そのため、このアプリで特別な対応は必要ありませんでした。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="expo-template-bare-minimumの更新履歴確認と対応"><code>expo-template-bare-minimum</code>の更新履歴確認と対応<a href="#expo-template-bare-minimumの更新履歴確認と対応" class="hash-link" aria-label="expo-template-bare-minimumの更新履歴確認と対応 への直接リンク" title="expo-template-bare-minimumの更新履歴確認と対応 への直接リンク">​</a></h3><p>このアプリでは<a href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/config-plugins">Config Pluginsに対応</a>しているので、<code>expo-template-bare-minimum</code>の更新に伴う個別の対応は基本的に必要ありません。
ただし、以下の場合は個別に対応する必要があるため、この観点に絞って<a href="https://github.com/expo/expo/commits/sdk-50/templates/expo-template-bare-minimum" target="_blank" rel="noopener noreferrer"><code>expo-template-bare-minimum</code>の更新履歴</a>を確認しました。</p><ul><li>このアプリで作成しているConfig Pluginsによる変更と、<code>expo-template-bare-minimum</code>の更新に伴う変更が競合した場合</li><li><a href="/mobile-app-crib-notes/react-native/santoku/development/build-configuration#prebuild">Prebuild</a>時に生成・更新されないファイル</li><li><code>android/</code>, <code>ios/</code>以外のファイル（<code>.gitignore</code>など）</li></ul><p>ここまでの対応以外に追加で必要なものはありませんでした。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ライセンス情報を更新">ライセンス情報を更新<a href="#ライセンス情報を更新" class="hash-link" aria-label="ライセンス情報を更新 への直接リンク" title="ライセンス情報を更新 への直接リンク">​</a></h3><p>このアプリでは、使用しているライブラリのライセンス一覧を出力するスクリプトを用意しています。詳細は、<a href="https://github.com/fintan-contents/mobile-app-crib-notes/blob/v2024.10/example-app/SantokuApp/.script/README.md" target="_blank" rel="noopener noreferrer">こちら</a>を参照してください。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="managed-licensejsの更新"><code>managed-license.js</code>の更新<a href="#managed-licensejsの更新" class="hash-link" aria-label="managed-licensejsの更新 への直接リンク" title="managed-licensejsの更新 への直接リンク">​</a></h4><p>ライセンス情報が不足しており補完したい、あるいは、開発時のみ使用するため除外したいライブラリとバージョンを<a href="https://github.com/fintan-contents/mobile-app-crib-notes/blob/v2024.10/example-app/SantokuApp/.script/managed-license.js" target="_blank" rel="noopener noreferrer">managed-license.js</a>で管理しています。</p><p>ライセンス情報が不足しているライブラリなどは、以下のコマンドを実行することで確認できます。</p><ul><li><code>node .script/check-licenses.js</code></li></ul><p>実行した結果、いくつかのライブラリのライセンス情報を更新する必要があったので以下を実施しました。</p><ul><li>使用ライブラリの名前更新</li><li>使用ライブラリのバージョン更新</li><li>使用ライブラリのライセンスファイルURL更新</li><li>新規ライブラリ情報の追加</li><li>使用しなくなったライブラリ情報の削除</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新規ライセンスへの対応">新規ライセンスへの対応<a href="#新規ライセンスへの対応" class="hash-link" aria-label="新規ライセンスへの対応 への直接リンク" title="新規ライセンスへの対応 への直接リンク">​</a></h4><p>このアプリでは、アプリに使用しても問題ないライセンスを管理してチェックできるようにしています。</p><p>今回のExpo SDKアップグレードでは、<a href="https://spdx.org/licenses/BlueOak-1.0.0.html" target="_blank" rel="noopener noreferrer">Blue Oak Model License 1.0.0</a>（<code>BlueOak-1.0.0</code>）のライブラリが増えました。
<code>BlueOak-1.0.0</code>はApacheライセンスやMITライセンスと似たパーミッシブ・ライセンスであり、ライセンス明記以外の対応は必要ないため使用可としました。
そのライセンス名（<code>BlueOak-1.0.0</code>）を<a href="https://github.com/fintan-contents/mobile-app-crib-notes/blob/v2024.10/example-app/SantokuApp/.script/check-licenses.js" target="_blank" rel="noopener noreferrer">check-licenses.js</a>の<code>licenseWhitelist</code>に追加しています。</p><p>また、以下のライセンスについてSPDX表記ではなく正式名で記載しているライブラリがあったため、<a href="https://github.com/fintan-contents/mobile-app-crib-notes/blob/v2024.10/example-app/SantokuApp/.script/list-dependencies.js" target="_blank" rel="noopener noreferrer">list-dependencies.js</a>の<code>aliasList</code>に追加しました。</p><ul><li><code>Boost Software License</code><ul><li><code>BSL-1.0</code>のエイリアスとして追加</li></ul></li><li><code>Blue Oak Model License</code><ul><li><code>BlueOak-1.0.0</code>のエイリアスとして追加</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated"><b><time datetime="2024-10-10T10:11:04.000Z">2024年10月10日</time></b>に<!-- -->最終更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-51-upgrade"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">Expo SDK 51アップグレード</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mobile-app-crib-notes/react-native/santoku/maintenance/enhance/expo-49-upgrade"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">Expo SDK 49アップグレード</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#expo-sdk-50の主な変更" class="table-of-contents__link toc-highlight">Expo SDK 50の主な変更</a><ul><li><a href="#react-native-v0736" class="table-of-contents__link toc-highlight">React Native <code>v0.73.6</code></a></li><li><a href="#プラットフォームに関連する破壊的変更" class="table-of-contents__link toc-highlight">プラットフォームに関連する破壊的変更</a></li><li><a href="#dev-toolsの改善" class="table-of-contents__link toc-highlight">Dev toolsの改善</a></li><li><a href="#react-native-pickerpickerのiosでの振る舞い変更" class="table-of-contents__link toc-highlight"><code>@react-native-picker/picker</code>のiOSでの振る舞い変更</a></li><li><a href="#ネイティブプロジェクトの更新ヘルパー" class="table-of-contents__link toc-highlight">ネイティブプロジェクトの更新ヘルパー</a></li><li><a href="#urlおよびurlsearchparamsの組み込み" class="table-of-contents__link toc-highlight"><code>URL</code>および<code>URLSearchParams</code>の組み込み</a></li><li><a href="#xcodeからアプリを起動した場合metro-bundlerが起動しないように変更" class="table-of-contents__link toc-highlight">Xcodeからアプリを起動した場合、Metro Bundlerが起動しないように変更</a></li><li><a href="#expoがサポートするライブラリや機能" class="table-of-contents__link toc-highlight">Expoがサポートするライブラリや機能</a></li></ul></li><li><a href="#このアプリで実施したアップグレードの手順" class="table-of-contents__link toc-highlight">このアプリで実施したアップグレードの手順</a><ul><li><a href="#expoのアップグレード" class="table-of-contents__link toc-highlight">Expoのアップグレード</a></li><li><a href="#expoが管理するライブラリのアップグレード" class="table-of-contents__link toc-highlight">Expoが管理するライブラリのアップグレード</a></li><li><a href="#バージョンの整合性が取れなくなったライブラリのアップグレード" class="table-of-contents__link toc-highlight">バージョンの整合性が取れなくなったライブラリのアップグレード</a></li><li><a href="#依存ライブラリから除外されたライブラリのインストール" class="table-of-contents__link toc-highlight">依存ライブラリから除外されたライブラリのインストール</a></li><li><a href="#不要となったライブラリのアンインストール" class="table-of-contents__link toc-highlight">不要となったライブラリのアンインストール</a></li><li><a href="#react-navigationのバージョンを更新" class="table-of-contents__link toc-highlight">React Navigationのバージョンを更新</a></li><li><a href="#npx-expo-doctorでバージョン整合性を確認" class="table-of-contents__link toc-highlight"><code>npx expo-doctor</code>でバージョン整合性を確認</a></li><li><a href="#既存パッチファイルの更新" class="table-of-contents__link toc-highlight">既存パッチファイルの更新</a></li><li><a href="#ビルドなどに利用するツールのバージョンを更新" class="table-of-contents__link toc-highlight">ビルドなどに利用するツールのバージョンを更新</a></li><li><a href="#config-pluginの修正" class="table-of-contents__link toc-highlight">Config Pluginの修正</a></li><li><a href="#静的解析エラーの修正" class="table-of-contents__link toc-highlight">静的解析エラーの修正</a></li><li><a href="#自動テストの失敗を修正" class="table-of-contents__link toc-highlight">自動テストの失敗を修正</a></li><li><a href="#react-native-pickerpickerの変更に伴う修正" class="table-of-contents__link toc-highlight"><code>@react-native-picker/picker</code>の変更に伴う修正</a></li><li><a href="#expoの更新履歴確認と対応" class="table-of-contents__link toc-highlight">Expoの更新履歴確認と対応</a></li><li><a href="#react-nativeの更新履歴確認と対応" class="table-of-contents__link toc-highlight">React Nativeの更新履歴確認と対応</a></li><li><a href="#expo-template-blank-typescriptの更新履歴確認と対応" class="table-of-contents__link toc-highlight"><code>expo-template-blank-typescript</code>の更新履歴確認と対応</a></li><li><a href="#expo-template-bare-minimumの更新履歴確認と対応" class="table-of-contents__link toc-highlight"><code>expo-template-bare-minimum</code>の更新履歴確認と対応</a></li><li><a href="#ライセンス情報を更新" class="table-of-contents__link toc-highlight">ライセンス情報を更新</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contents</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mobile-app-crib-notes/reference">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">React Native</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mobile-app-crib-notes/react-native/learn">Learn</a></li><li class="footer__item"><a class="footer__link-item" href="/mobile-app-crib-notes/react-native/santoku">Example App</a></li><li class="footer__item"><a class="footer__link-item" href="/mobile-app-crib-notes/react-native/common-pitfalls">Trouble shooting</a></li></ul></div><div class="col footer__col"><div class="footer__title">Related Work</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://fintan.jp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Fintan<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://fintan.jp/?p=5952" target="_blank" rel="noopener noreferrer" class="footer__link-item">SPA + REST API構成のサービス開発リファレンス<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://fintan.jp/blog-tag/react-native" target="_blank" rel="noopener noreferrer" class="footer__link-item">Fintan » React Native<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div class="no-content">
<div class="copyright">
  ドキュメントは、<a rel="license" href="https://fintan.jp/?page_id=201" target="_blank">Fintan コンテンツ 使用許諾条項</a>の下に提供されており、コードサンプルは<a rel="license" href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache 2.0 License</a>の下に提供されています。
</div>
<div class="supplementary">
  <a href="/mobile-app-crib-notes/terms-of-use/" class="footer__link-item">当サイトのご利用にあたって</a>
  <a href="/mobile-app-crib-notes/trademark/" class="footer__link-item">商標について</a>
</div>
</div>
</div></div></div></footer></div>
<script src="/mobile-app-crib-notes/assets/js/runtime~main.614d1847.js"></script>
<script src="/mobile-app-crib-notes/assets/js/main.27dbf87e.js"></script>
</body>
</html>