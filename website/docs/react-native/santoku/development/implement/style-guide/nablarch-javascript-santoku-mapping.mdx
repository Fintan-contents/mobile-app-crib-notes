---
title: NablarchのJavaScript規約一覧
---

<!-- textlint-disable -->
<!-- markdownlint-disable -->

> TODO: レビュー用。マージする前に削除する。

## 2. コードスタイルに関する規約
### 2.1 ソースコードレイアウト

| 項     |タイトル| 内容                                                           | SantokuAppの対応                                    |
|:------|:--|:-------------------------------------------------------------|:-------------------------------------------------|
| 2.1.1 |文字コード ★| ソースコードの文字コードは全て UTF-8 で記述する。                                 | EditorConfig                                     |
| 2.1.2 |改行 ★| 改行にはLF(0x0A) を使用すること。                                        | Prettier                                         |
| 2.1.3 |インデント ★| インデントは 半角スペース を2つ使用すること。タブの使用は認めない。※静的検査ツールで検査を行う。           | Prettier                                         |
| 2.1.4 |行の長さ ★| 1行あたりの文字数は最大で 120字 を上限とする。通常は80字 以内とすることが望ましい。※静的検査ツールで検査を行う。 | Prettier                                         |
| 2.1.5 |ステートメント ★| 複数のステートメントを1行に記述することは避ける。各ステートメントの末尾には必ず セミコロン ";" を記述すること。  | Prettier                                         |
| 2.1.6 |演算子 ★| 2項演算子は前後のオペランドとの間に空白1文字を挿む。一方、単項演算子の場合はオペランドとの間を隣接させる。ただし、同じ単行演算子でも、typeof と instanceof については(当然ながら)オペランドとの間に空白が必要である。  | Prettier                                         |
| 2.1.7 |括弧の位置 ★| ブロック等で使用する括弧の記述位置は、いわゆる K&R記法 に従うものとする。すなわち、ステートメントと同じ行の末尾に開き括弧を配置し、かつ、閉じ括弧の位置はステートメントの先頭列に合わせる。また、 for, if, switch 等のキーワードと括弧が並ぶ場合は、空白1文字を挿む。一方、関数の呼び出しや、配列添字のアクセスのように、識別子と括弧が並ぶ場合は、間をあけずに隣接させる。 | Prettier                                         |
| 2.1.8 |変数宣言 ★| 変数宣言はletとconstのいずれかを使用する。値を再代入しない場合、または定数はconstを使用する。それ以外はletを使用する。varはES2015が登場する前に使われていたキーワードであり、スコープが関数単位という特徴がある。可能な限りvarは使わず、より狭いブロック単位のスコープで変数を宣言できるletやconstを使うようにすること。 | ESLint（fix対象）、ただしlet、const、varのいづれも付けない場合はTSCエラー |
| 2.1.9 |制御構文中の括弧の省略 ★| 言語仕様上、省略が許されている括弧についても、必ず明示的に記述する。次のコードはif文の括弧を省略している。 | ESLint（fix）                      |

### 2.2 命名規約
本節では、プログラム中の各識別子の命名規則について説明する。

| 項     |タイトル| 内容                                                           | SantokuAppの対応                   |
|:------|:--|:-------------------------------------------------------------|:--------------------------------|
| 2.2.1 |変数 ★| 変数の名前は、その変数に格納する内容を端的に表す 名詞 とし、必要に応じて前後に 形容詞 、 形容詞句 を付加する。また、誤読の心配が無い限り 冠詞 は省略する。先頭文字は小文字とし、 各単語はキャメル記法に従って連結する。特に、変数の内容がリストやハッシュテーブルのようなコレクションとして使用される場合は、変数名は要素を表す名詞の複数形か、そのコレクション自体を表す名詞とする。 | 対象（Javaの規約の命名ルールと合わせて考える）       |
| 2.2.2 |定数 ★| 定数は必ずconstを使用して定義する。変数名は全て大文字かつ単語間の区切りにアンダースコア("_")を用いる。 | 対象（Javaの規約の命名ルールと合わせて考える）                              |
| 2.2.3 |ループ変数 ★| for文等のループ構文において、カウンタとして使用される変数の名称には、慣用的に使用される変数名 (i, j, k ...) を使用できる。| 対象（Javaの規約の命名ルールと合わせて考える）                              |
| 2.2.4 |変数(真偽値) ★| 真偽値を格納する変数の名前は、形容詞、もしくは 節 とする。節の時制は、基本的に状態動詞の場合は現在形、動作動詞の場合は過去形とし、主語が明確である場合は省略する。| 対象（Javaの規約の命名ルールと合わせて考える）                              |
| 2.2.5 |変数(関数名) ★|JavaScriptでは関数も単なるオブジェクトであるため、関数名は単に関数オブジェクトを格納する変数の名前である。関数オブジェクトを格納する変数の名前は、その処理の内容を端的に表す 原型の動作動詞 とする。関数が引数をとる場合は、その引数の内容を目的語とする 前置詞 を追加し、(動詞 + 前置詞) としてもよい。なお、その関数が、内部状態を変更しない単純な問い合わせ処理(いわゆるアクセサ)である場合は、その関数の戻り値の内容を端的に表す 名詞 としてもよい。また、関数オブジェクトをスコープの外部で実行することを意図して、引数や戻り値を通じて受け渡す場合も、その目的を表す 名詞 としてよい。 | 対象（Javaの規約の命名ルールと合わせて考える）                              |
| 2.2.6 |変数(コンストラクタ関数名) ★| new演算子とあわせて使用することを前提としている関数(コンストラクタ)の関数名は、そのコンストラクタが生成するインスタンスの特徴を端的に表す 名詞 とし、先頭の文字は大文字で開始すること。 | 対象（内容をクラス/インターフェース/型エイリアスに変更する）（Javaの規約の命名ルールと合わせて考える） |
| 2.2.7 |変数(jQueryオブジェクト) ★|jQueryオブジェクトを格納する変数の名前は “$" で開始すること。 | 対象外                             |

### 2.3 リテラルの記述

| 項     |タイトル| 内容                                                           | SantokuAppの対応 |
|:------|:--|:-------------------------------------------------------------|:--------------|
| 2.3.1 |文字リテラルの記述 ★| 文字リテラルのクォート文字には、ダブルクォート(")を使用すること。ただし、文字列中にダブルクォートが多く、エスケープが煩わしい場合は、シングルクォート(')を用いてもよい。 | Prettier      |
| 2.3.2 |オブジェクトリテラルの記述 ★| キー文字列のクウォートにはダブルクォートを用いるが、キーが半角英数文字およびアンダースコアのみで構成されている場合は省略することができる。また、キー名にダブルクォートが含まれ、エスケープが煩わしい場合は、シングルクォート(')を用いてもよい。 | Prettier      |
| 2.3.3 |正規表現リテラルの記述 ★|正規表現を使用する場合は、可能であれば、文字列引数ではなく、正規表現リテラルを使用すること。ただし、正規表現の内容が動的に変わる場合や、正規表現の内容が複雑でコメントが必要となる場合は、RegExp()コンストラクタを使用すること。 | 対象        |

## 3 セキュリティに関する規約
### 3.1 JavaScript一般

| 項     |タイトル| 内容                                                           | SantokuAppの対応 |
|:------|:--|:-------------------------------------------------------------|:--------------|
| 3.1.1 |ソースコードの動的評価(eval()/Functionコンストラクタ)を使用しない。 ★| これらの関数の引数に外部から操作できる文字列を連結している場合は、ブラウザ上で任意のコードを実行できる危険性があるため、原則使用しないこと。 | ESLint    |

### 3.2 jQuery関連
| 項     |タイトル| 内容                                                           | SantokuAppの対応 |
|:------|:--|:-------------------------------------------------------------|:--|
| 3.2.1 |文字列からDOMノードを生成する関数の引数に変数を連結しない。 ★| jQueryの $()コンストラクタや、$.append() などのメソッドでは、引数にhtmlを表す文字列を渡すことで、そのhtmlの内容に相当するDOMノードを生成することができる。しかし、これらの文字列に外部から操作できる値を連結している場合は、変数にscript要素等を挿入することにより任意のスクリプトが実行でき、XSS脆弱性の直接の原因となる。 |対象外|

## 4 パフォーマンスに関する規約
### 4.1 JavaScript一般

| 項     |タイトル| 内容                                                           | SantokuAppの対応                                                                                                                                                            |
|:------|:--|:-------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 4.1.1 |for文開始前に走査対象となる配列の長さを取得しておく。 ★| Array や Arguments オブジェクトような配列型オブジェクトを操作する場合、以下のようにループ毎に length プロパティにアクセスするとパフォーマンスが劣化する場合がある。 | 対象外（そんなにパフォーマンス劣化する？という疑念があるので一旦外す）                                                                                                                                      |
| 4.1.2 |ループ内での文字連結処理には Array.prototype.join() を使用する。 ★| 下記の例のように、ループ内で文字列の連結を行なうような場合、+ 演算子や String.prototype.concat()を使用すると、一部のブラウザでは性能が極端に劣化する傾向がある。 | 対象外（そんなにパフォーマンス劣化する？という疑念があるので一旦外す）                                                                                                                                                                      |
| 4.1.3 |with句を使用しない。★|with句を使用した場合は、ローカル変数を格納したスコープの内側にスコープを挿入することになり、ローカル変数へのアクセス性能が劣化する。このため、with句は使用しないこと。 | 対象外（TSCエラー、TS1101: 'with' statements are not allowed in strict mode.、TS2410: The 'with' statement is not supported. All symbols in a 'with' block will have type 'any'.） |
| 4.1.4 |script要素はページの終端付近に配置する。|ブラウザは、初期表示処理の際、JavaScriptファイルのダウンロードおよびスクリプトの評価を行なっている間は後続の要素のレンダリング処理を停止する。このため、script要素がhead要素やドキュメントの中間に挿入されていると画面描画の完了が遅れる。この問題を回避するため、script要素の配置位置はドキュメントの末尾(body要素の終了タグ直前)に配置することを推奨する。こうすることで、スクリプトファイルのダウンロードおよびスクリプトの評価は、画面のレンダリング処理と並行で行なわれるようになり、体感的なパフォーマンスが向上する。 | 対象外                                                                                                                                                                      |

### 4.2 jQuery関連

| 項     |タイトル| 内容                                                           | SantokuAppの対応 |
|:------|:--|:-------------------------------------------------------------|:--|
| 4.2.1 |セレクタの処理結果をキャッシュする。 ★| $()コンストラクタによるセレクタ処理は比較的負荷の高い処理であるので、セレクタの結果を複数回参照する場合は必ずローカル変数にキャッシュすること。 |対象外|
| 4.2.2 |ブラウザが直接処理できるセレクタをセレクタ式の先頭に記述する。| $()によるセレクタ処理では、渡されたセレクタ式の内容を解析し、ブラウザのネイティブAPIで実行できる内容であれば、ブラウザに処理を移譲する。特に、$("#ID") 、$("TAG") 、$(".CLASSNAME") はそれぞれ、ブラウザのgetElementById() / getElementsByTagName() / getElementsByClassName()で直接処理されるため、非常に高速である。従って、この2つのセレクタを先頭に配置することで、セレクタの性能を向上させることができる。 |対象外|

## 5 プログラムの堅牢性に関する規約
### 5.1 JavaScript一般

| 項     |タイトル| 内容                                                           | SantokuAppの対応                     |
|:------|:--|:-------------------------------------------------------------|:----------------------------------|
| 5.1.1 |strictディレクティブをグローバルスコープで使用しない。| strictディレクティブを使用することで、対応するブラウザでは、以下のような問題のあるコードを明示的なエラーとして検出することができる。 | 対象外                               |
| 5.1.2 |暗黙的な型変換をともなう比較演算子 (==, !=) は使用しない。 ★|論理演算子 == と !== は両辺の型が異なる場合、暗黙的な型変換を行うため、プログラマが意図しない結果となることがある。例えば、以下のステートメントは真と判定される。  | ESLint                            |
| 5.1.3 |例外を捕捉しない。(try-catch-finallyブロックを使用しない。)|ブラウザ内で発生したエラーを捕捉したとしても、サーバー側のアプリケーションのように 障害ログ出力や復旧処理ができるわけではないので、エラーオブジェクトの補足は原則行わず、ブラウザのデフォルト動作に任せるものとする。 | 対象外                               |
| 5.1.4 |オブジェクトのループにはObject.keysを利用する。★|for-in ループでは、プロトタイプチェイン上のプロパティも走査するため、本来、予期しない要素が処理対象となってしまう場合がある。これを避けるため、Object.keys() を使ってループを記述すること。 | 対象外（for-in文を使えないようにESLintを設定するため） |
| 5.1.5 |グローバル変数の定義を行なわない。 ★|グローバル変数(windowオブジェクトのプロパティ) を新たに定義することを禁止する。 | 対象                            |
| 5.1.6 |プロトタイプの拡張を行わない。 ★| 既存のコンストラクタ関数に対するプロトタイプオブジェクトの変更を原則として禁じる。ただし、jQueryプラグインを作成する場合に限り、jQueryオブジェクトのプロトタイプ定義(jQuery.fn)の拡張を認める。 | 対象                            |
| 5.1.7 |JavaScriptをHTMLに直接記述する場合、「-」（ハイフン）を2つ以上連続して記述しない。★| JavaScriptをHTMLに直接記述する場合は、n:scriptカスタムタグを使用する。n:scriptカスタムタグは、JavaScriptに未対応のブラウザが画面上にJavaScriptコードを表示するのを防ぐため、JavaScriptコードをHTMLコメントとして出力する。| 対象外                               |

### 5.2 jQuery関連

| 項     |タイトル| 内容                                                           | SantokuAppの対応 |
|:------|:--|:-------------------------------------------------------------|:--------------|
| 5.2.1 |DOM関連APIを直接使用することを避ける。| DOM関連APIは、ブラウザごとにインターフェースの差異が存在するため、直接これらのAPIを使用せず、jQueryの同等の関数を通じて使用すること。 | 対象外           |
| 5.2.2 |:enabled 擬似セレクタを使用しない。 ★|  | 対象外             |

