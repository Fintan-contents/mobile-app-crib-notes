---
title: プッシュ通知の受信
---

iOSアプリの場合はAPNsから、Androidアプリの場合はATLからそれぞれプッシュ通知を受信します。

## プッシュ通知受信時の処理フロー

アプリの状態がフォアグラウンド（アクティブ）の場合とそれ以外の場合で処理フローが異なります。

プッシュ通知を受信した際、アプリの状態により通知の取り扱いが変わります。
アプリの状態には次のものがあります。

- フォアグラウンド（アクティブ）
- フォアグラウンド（非アクティブ）
- バックグラウンド（一時停止）
- バックグラウンド（停止）

アプリの状態の詳細は[アプリの状態](../life-cycle-management/overview.mdx#アプリの状態)を参照してください。

処理フローは以下になります。

### フォアグラウンド（アクティブ）の場合

![プッシュ通知受信時の処理フロー](receive-push-notification.drawio.png)

アプリの状態がフォアグラウンド（アクティブ）の際にプッシュ通知を受信すると、`onMessage`に設定した処理が呼ばれます。
`onMessage`で受け取った通知内容をスナックバーでアプリ上に表示します。その他、通知内容に応じた処理があれば行いますが、画面遷移などユーザの操作を妨げる処理は行わないこととします。

### フォアグラウンド（アクティブ）以外の場合

フォアグラウンド（アクティブ）以外の状態でプッシュ通知を受信すると、通知は通知センターに表示されます。
アプリはプッシュ通知を受信した時点では何も行いません。

## 通知センターのプッシュ通知タップ時の処理フロー

通知センターのプッシュ通知をタップ時するとアプリがフォアグランドで表示します。
その際のアプリスタートの種類により通知の取り扱いが変わります。
アプリスタートの種類には次のものがあります。

- コールドスタート
- ウォームスタート
- ホットスタート

アプリスタートの種類の詳細は[アプリスタートの種類に応じた初期化処理](../life-cycle-management/overview.mdx#アプリスタートの種類に応じた初期化処理)を参照してください。

処理フローは以下になります。

### ホットスタートの場合

![プッシュ通知タップ時(Background)の処理フロー](tap-push-notification-when-background.drawio.png)

ホットスタートの場合、`onNotificationOpenedApp`に設定した処理が呼ばれます。
この中で通知内容に応じた処理（画面遷移など）を行います。

### コールドスタートまたはウォームスタートの場合

![プッシュ通知タップ時(Quit)の処理フロー](tap-push-notification-when-quit.drawio.png)

React Nativeアプリでは、コールドスタートとウォームスタートはほぼ同等です。
コールドスタートまたはウォームスタートの場合、`getInitialNotification`で取得した通知内容に応じた処理（画面遷移など）を行います。
