---
title: 🚧 (後でHTTP APIのページに移行) 🚧 HTTP API通信で発生するエラーのハンドリング
---

HTTP APIは、HTTPステータスコードを使用して処理の成功と失敗を表します。

| HTTPステータスコード | 意味                         |
| :---------------- | :-------------------------- |
| 2xx               | 成功                         |
| 4xx               | クライアントサイドに起因するエラー |
| 5xx               | サーバサイドに起因するエラー      |

HTTPステータスコードが4xxの場合は、モバイルアプリケーションの操作によって解決が可能なエラーになります。HTTPステータスコードが5xxの場合は、モバイルアプリケーションの操作では解決できないエラーとなります。

## HTTPステータスコードが4xxのエラーハンドリング

本アプリケーションでは以下のHTTPステータスコードの場合、ユーザにエラーの内容と解消のための適切な手順を伝えます。ここに含まれないHTTPステータスコードの場合は、想定外のエラーとしてアラートを表示します。

| HTTPステータスコード | 意味                                                                        | ハンドリング箇所 |
| :---------------- | :------------------------------------------------------------------------- | :------------ |
| 400               | BadRequest - リクエストとして送るペイロードが精査エラーになった場合など               | 個別           |
| 401               | Unauthorized - IDトークンの期限が切れた場合                                     | 共通           |
| 404               | Not found - リソースが見つからなかった場合                                       | 個別           |
| 412               | Precondition Failed - 操作しているモバイルアプリケーションが強制アップデート対象の場合 | 共通           |
| 429               | Too many requests - クライアントから大量のリクエストが送信された場合                | 共通           |

## HTTPステータスコードが5xxのエラーハンドリング

本アプリケーションではHTTPステータスコード503場合、ユーザにシステムメンテナンス中であることを伝えます。ここに含まれないHTTPステータスコードの場合は、想定外のエラーとしてアラートを表示します。

| HTTPステータスコード | 意味                                                                        | ハンドリング箇所 |
| :---------------- | :------------------------------------------------------------------------- | :------------ |
| 503               | Service Unavailable - HTTP APIがシステムメンテナンスで止まっている場合             | 共通           |

## HTTP APIからレスポンスが返却されない場合のエラーハンドリング

HTTP APIからレスポンスが返却されない場合は、以下のような原因が考えられます。

- 端末のネットワークがOFFになっている場合
- HTTP APIとの通信中にネットワークが切断された場合
- HTTP APIとの通信がタイムアウトしない場合
  - コネクションタイムアウト
  - 書き込みタイムアウト
  - 読み込みタイムアウト

これらの場合は、エラーを捕捉してネットワークの状態の確認を促すメッセージを表示します。

HTTP APIとの通信に使用しているライブラリによってはコネクションタイムアウトや書き込みタイムアウト、読み込みタイムアウトが設定できない場合もあります。
そのような場合はHTTP APIとの通信をクライアント側から明示的にキャンセルしないと通信が切断されないため、通信のキャンセル処理を実施します。

> 🚧 作業中 🚧
<!--
TODO: Fetch API / Axiosそれぞれについて、どのタイムアウト設定ができるかを記載
      コネクションタイムアウトなどがちゃんと効くかの検証が必要
-->

## HTTP APIのエラーハンドリングを共通で実施する方法

> 🚧 作業中 🚧
<!--
TODO: SantokuAppで実装してから追記
-->
