<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ログイン資格情報の保管方法 # プラットフォームに応じてセキュアな方法でログイン資格情報（OIDCのトークンやセッションIDなど）を保管してくだ"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="ログイン資格情報の管理"><meta property="og:description" content="ログイン資格情報の保管方法 # プラットフォームに応じてセキュアな方法でログイン資格情報（OIDCのトークンやセッションIDなど）を保管してくだ"><meta property="og:type" content="article"><meta property="og:url" content="/docs/auth/management-of-log-in-credentials/"><title>ログイン資格情報の管理 | Santoku</title><link rel=manifest href=../../../manifest.json><link rel=icon href=../../../favicon.png type=image/x-icon><link rel=stylesheet href=../../../book.min.b3215d9d1d18d9051e7fbe8f256ff80e30f41d29073b86348e230d297b771002.css integrity="sha256-syFdnR0Y2QUef76PJW/4DjD0HSkHO4Y0jiMNKXt3EAI="></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=../../../><span>Santoku</span></a></h2><ul><li><a href=../../../docs/notes-in-mobile-application-development/>セキュリティ</a></li><li><a href=../../../docs/auth/>認証アーキテクチャ</a><ul><li><a href=../../../docs/auth/how-to-display-login-page/>ログイン画面の表示パターン</a></li><li><a href=../../../docs/auth/management-of-log-in-credentials/ class=active>ログイン資格情報の管理</a></li><li><a href=../../../docs/auth/stateless-authn/>ステートレスな認証</a></li></ul></li><li><a href=../../../docs/webassets-integration/>Webアプリとの認証情報の連携</a><ul></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=../../../svg/menu.svg class=book-icon alt=Menu></label>
<strong>ログイン資格情報の管理</strong>
<label for=toc-control><img src=../../../svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#ログイン資格情報の保管方法>ログイン資格情報の保管方法</a></li><li><a href=#ログイン資格情報のライフサイクル管理における注意点>ログイン資格情報のライフサイクル管理における注意点</a><ul><li><a href=#android-keystore>Android (KeyStore)</a></li><li><a href=#ios-keychain>iOS (Keychain)</a></li></ul></li></ul></nav></aside></header><article class=markdown><h2 id=ログイン資格情報の保管方法>ログイン資格情報の保管方法
<a class=anchor href=#%e3%83%ad%e3%82%b0%e3%82%a4%e3%83%b3%e8%b3%87%e6%a0%bc%e6%83%85%e5%a0%b1%e3%81%ae%e4%bf%9d%e7%ae%a1%e6%96%b9%e6%b3%95>#</a></h2><p>プラットフォームに応じてセキュアな方法でログイン資格情報（OIDCのトークンやセッションIDなど）を保管してください。</p><ul><li>Android: KeyStoreに保存した鍵で暗号化して、SharedPreferenceに保管する</li><li>iOS: Keychainに保管する</li></ul><h2 id=ログイン資格情報のライフサイクル管理における注意点>ログイン資格情報のライフサイクル管理における注意点
<a class=anchor href=#%e3%83%ad%e3%82%b0%e3%82%a4%e3%83%b3%e8%b3%87%e6%a0%bc%e6%83%85%e5%a0%b1%e3%81%ae%e3%83%a9%e3%82%a4%e3%83%95%e3%82%b5%e3%82%a4%e3%82%af%e3%83%ab%e7%ae%a1%e7%90%86%e3%81%ab%e3%81%8a%e3%81%91%e3%82%8b%e6%b3%a8%e6%84%8f%e7%82%b9>#</a></h2><p>AndroidならKeyStore、iOSならKeychainを利用することを前提に、ログイン資格情報のライフサイクル管理についていくつか注意点を紹介します。</p><h3 id=android-keystore>Android (KeyStore)
<a class=anchor href=#android-keystore>#</a></h3><p>KeyStoreに保存した鍵は、以下のような操作で消えてしまいます。鍵が取得できない場合はユーザに再度ログイン操作を要求する必要があります。</p><ul><li>アプリのアンインストール</li><li><a href="https://developer.android.com/training/articles/keystore?hl=ja#UserAuthentication">キー使用を承認するうえでユーザー認証を要求する</a>場合は、承認内容に応じてキーが無効化されるタイミングは異なります。以下に概要を示しますが、詳細についてリンク先のドキュメントを確認してください。<ul><li>ユーザ認証に基づいて、一定期間、キーを使用することを承認する<ul><li>セキュアロック画面が無効化された場合や強制的にリセットされた場合</li></ul></li><li>ユーザ認証によって、キーと暗号処理の組み合わせを個別に承認する（指紋認証の場合のみ利用可能）<ul><li>新しい指紋が登録された場合やすべての指紋の登録が抹消された場合</li></ul></li></ul></li></ul><h3 id=ios-keychain>iOS (Keychain)
<a class=anchor href=#ios-keychain>#</a></h3><h4 id=1-アプリをアンインストールしても消えない>1. アプリをアンインストールしても消えない
<a class=anchor href=#1-%e3%82%a2%e3%83%97%e3%83%aa%e3%82%92%e3%82%a2%e3%83%b3%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab%e3%81%97%e3%81%a6%e3%82%82%e6%b6%88%e3%81%88%e3%81%aa%e3%81%84>#</a></h4><p>Keychainの情報はアプリをアンインストールしても消えないため、特に何もしない場合は再インストール後も認証状態が引き継がれることになります。</p><p>インストール後に必ず認証が必要な場合は、UserDefaultsにフラグを設けてインストールされてからのログイン実績を管理するなどの実装が必要になります。</p><h4 id=2-icloudで同期される>2. iCloudで同期される
<a class=anchor href=#2-icloud%e3%81%a7%e5%90%8c%e6%9c%9f%e3%81%95%e3%82%8c%e3%82%8b>#</a></h4><p>Keychainに保存した情報は、iCloud同期により同じAppleIDでログインしている別の端末に同期されます。さらに、iCloud同期のタイミングは不定期のため、いつバックアップ/同期されるか分かりません。</p><p>一台でのみ利用されることが前提の情報を安易にKeychainに保管してしまうと、複数台で同時に利用されて予期しない不整合が発生してしまう可能性があります。例えば、アクセストークンやリフレッシュトークンを一度しか利用できないように制限している場合などが該当します。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><hr style=margin-top:4rem><p>ドキュメントは、<a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>クリエイティブ・コモンズ 表示 - 継承 4.0 国際 ライセンス</a>の下に提供されており、コードサンプルは<a rel=license href=https://www.apache.org/licenses/LICENSE-2.0>Apache 2.0 License</a>の下に提供されています。</p><div style=display:flex;justify-content:space-between;align-items:flex-start><p><a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/><img alt=クリエイティブ・コモンズ・ライセンス style=border-width:0;height:auto src=https://i.creativecommons.org/l/by-sa/4.0/88x31.png></a></p><p><a href=../../../trademark/>商標について</a></p></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#ログイン資格情報の保管方法>ログイン資格情報の保管方法</a></li><li><a href=#ログイン資格情報のライフサイクル管理における注意点>ログイン資格情報のライフサイクル管理における注意点</a><ul><li><a href=#android-keystore>Android (KeyStore)</a></li><li><a href=#ios-keychain>iOS (Keychain)</a></li></ul></li></ul></nav></aside></main></body></html>